import{c as k,r as o,j as e,d as D,ac as M,R as W,e as N,D as Z,x as G,y as X,z as J,A as Q,ad as Y,v as L,h as A,B as g,X as ee,K as se}from"./index-Cm5HjFIo.js";import{P as te}from"./exportData-RkqjTXsm.js";import{F as V}from"./file-text-BFQ76zi5.js";import{D as ae}from"./download-DTd9ExxB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=k("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=k("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=k("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ne=M("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),w=o.forwardRef(({className:i,variant:d,...l},p)=>e.jsx("div",{ref:p,role:"alert",className:D(ne({variant:d}),i),...l}));w.displayName="Alert";const b=o.forwardRef(({className:i,...d},l)=>e.jsx("h5",{ref:l,className:D("mb-1 font-medium leading-none tracking-tight",i),...d}));b.displayName="AlertTitle";const C=o.forwardRef(({className:i,...d},l)=>e.jsx("div",{ref:l,className:D("text-sm [&_p]:leading-relaxed",i),...d}));C.displayName="AlertDescription";const oe={zones:{singular:"Zone",plural:"Zones",description:"Importez vos zones depuis un fichier CSV"},equipment:{singular:"Équipement",plural:"Équipements",description:"Importez vos équipements depuis un fichier CSV"},sensors:{singular:"Capteur",plural:"Capteurs",description:"Importez vos capteurs depuis un fichier CSV"}},ue=({open:i,onOpenChange:d,importType:l,onImportSuccess:p})=>{var R,U;const[m,x]=o.useState(null),[j,v]=o.useState(!1),[I,f]=o.useState(0),[n,c]=o.useState(null),[u,_]=o.useState(null),[q,F]=o.useState(!1),S=o.useRef(null),h=oe[l];W.useEffect(()=>{i&&!u&&E()},[i,l]);const E=async()=>{F(!0);try{const s=await N.get(`/import/info/${l}`);_(s.data)}catch(s){console.error("Error fetching import info:",s)}finally{F(!1)}},P=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){if(t.type!=="text/csv"&&!t.name.endsWith(".csv")){c({success:!1,message:"Veuillez sélectionner un fichier CSV valide"});return}x(t),c(null)}},O=s=>{var r;s.preventDefault();const t=(r=s.dataTransfer.files)==null?void 0:r[0];if(t){if(t.type!=="text/csv"&&!t.name.endsWith(".csv")){c({success:!1,message:"Veuillez sélectionner un fichier CSV valide"});return}x(t),c(null)}},T=s=>{s.preventDefault()},$=async()=>{var t;if(!m)return;v(!0),f(0),c(null);const s=new FormData;s.append("file",m);try{const r=await N.post(`/import/${l}`,s,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{const K=a.total?Math.round(a.loaded*100/a.total):0;f(K)}});c({success:!0,message:r.data.message||"Import réussi",imported_count:r.data.imported_count,data:r.data.data}),p&&p()}catch(r){const a=(t=r.response)==null?void 0:t.data;c({success:!1,message:(a==null?void 0:a.message)||"Une erreur est survenue lors de l'import",errors:(a==null?void 0:a.errors)||[]})}finally{v(!1),f(100)}},B=async()=>{try{const s=await N.get(`/import/template/${l}`,{responseType:"blob"}),t=new Blob([s.data],{type:"text/csv"}),r=window.URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`template_${l}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}catch(s){console.error("Error downloading template:",s)}},H=()=>{x(null),c(null),f(0),v(!1)},z=()=>{H(),d(!1)};return e.jsx(Z,{open:i,onOpenChange:z,children:e.jsxs(G,{className:"max-w-2xl w-[95vw] sm:w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(X,{children:[e.jsxs(J,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Importer des ",h.plural]}),e.jsx(Q,{className:"text-sm",children:h.description})]}),e.jsx(Y,{className:"flex-1 max-h-[60vh]",children:e.jsxs("div",{className:"space-y-4 p-1",children:[q?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):u&&e.jsxs(w,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(b,{children:"Format attendu"}),e.jsxs(C,{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-2",children:"Colonnes requises :"}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:(R=u.required_columns)==null?void 0:R.map(s=>e.jsx(A,{variant:"default",className:"text-xs",children:s},s))}),((U=u.optional_columns)==null?void 0:U.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm mb-2 mt-3",children:"Colonnes optionnelles :"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.optional_columns.map(s=>e.jsx(A,{variant:"outline",className:"text-xs",children:s},s))})]})]})]}),e.jsxs("div",{onDrop:O,onDragOver:T,onClick:()=>{var s;return(s=S.current)==null?void 0:s.click()},className:`border-2 border-dashed rounded-lg p-6 sm:p-8 text-center cursor-pointer transition-colors ${m?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,children:[e.jsx("input",{ref:S,type:"file",accept:".csv",onChange:P,className:"hidden"}),m?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"w-10 h-10 text-primary"}),e.jsx("p",{className:"font-medium text-sm",children:m.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(m.size/1024).toFixed(2)," Ko"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),x(null),c(null)},className:"mt-2",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Supprimer"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(y,{className:"w-10 h-10 text-muted-foreground"}),e.jsx("p",{className:"font-medium text-sm",children:"Glissez votre fichier CSV ici"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ou cliquez pour sélectionner un fichier"})]})]}),j&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Import en cours..."}),e.jsxs("span",{children:[I,"%"]})]}),e.jsx(te,{value:I,className:"h-2"})]}),n&&e.jsxs(w,{variant:n.success?"default":"destructive",children:[n.success?e.jsx(le,{className:"h-4 w-4"}):e.jsx(re,{className:"h-4 w-4"}),e.jsx(b,{children:n.success?"Import réussi":"Erreur d'import"}),e.jsxs(C,{className:"mt-2",children:[e.jsx("p",{children:n.message}),n.imported_count!==void 0&&e.jsxs("p",{className:"mt-1 font-medium",children:[n.imported_count," ",n.imported_count>1?h.plural.toLowerCase():h.singular.toLowerCase()," importé(s)"]}),n.errors&&n.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-medium mb-1",children:"Erreurs détectées :"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-1 max-h-32 overflow-y-auto",children:n.errors.map((s,t)=>e.jsx("li",{children:s},t))})]})]})]})]})}),e.jsxs(se,{className:"flex-col sm:flex-row gap-2 sm:gap-0 mt-4",children:[e.jsxs(g,{type:"button",variant:"outline",onClick:B,className:"w-full sm:w-auto gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Télécharger le modèle"]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(g,{type:"button",variant:"ghost",onClick:z,className:"flex-1 sm:flex-none",children:"Fermer"}),e.jsx(g,{type:"button",onClick:$,disabled:!m||j,className:"flex-1 sm:flex-none gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 animate-spin"}),"Import..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4"}),"Importer"]})})]})]})]})})};export{ue as C,y as U};
