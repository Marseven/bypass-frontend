import{a8 as ve,r,j as e,L as Q,B as i,K as be,q as F,D as Ce,w as ye,x as De,y as Se,z as ke,A as Ae,M as ze,v as Te,S as n,h as W,e as L}from"./index-BczWxPqK.js";import{C as w,a as b,b as P,c as X,d as Ee}from"./card-oZQTdWFE.js";import{L as O}from"./label-gqyoG80I.js";import{A as Y,a as ee,T as se,b as ae,c as te,d as le,e as re,f as ie,g as ne,h as ce}from"./alert-dialog-BmnXhzd-.js";import{S as Le,a as Pe,b as Ie,c as Ze,d as S}from"./select-CiETPwVI.js";import{T as me,a as oe,b as k,c as u,d as de,e as x}from"./table-CzPeITGD.js";import{P as Me,a as qe,b as V,c as Be,d as Fe,e as Oe}from"./pagination-CMbAxhuR.js";import{B as Ve,a as _e,b as xe,c as $e,d as He,e as Ge}from"./breadcrumb-CtRI8p6G.js";import{e as Ue}from"./exportData-DV5nx9fi.js";import{U as Re,C as Ke}from"./CsvImportDialog-DLS_BUik.js";import{M as A}from"./map-pin-Dc8qMHA7.js";import{A as Je}from"./arrow-left-CNdL_MWX.js";import{D as Qe}from"./download-Ca9os_lj.js";import{P as _}from"./plus-BlODmAW9.js";import{L as We,T as Xe}from"./table-D-vQgLYC.js";import{P as he}from"./pen-6K1olmgN.js";import"./index-Cs9P0kFJ.js";import"./file-text-CSi2gb9O.js";const fs=()=>{const{toast:m}=ve(),[h,$]=r.useState([]),[o,g]=r.useState(1),[d,ue]=r.useState(3),[z,pe]=r.useState(""),[N,H]=r.useState("grid"),[I,T]=r.useState(!0),[G,v]=r.useState(!1),C=async()=>{T(!0);try{const s=await L.get("/zones").then(a=>{if(a.data.data.length!==0){console.log(a.data);const f=a.data.data.map(t=>({id:t.id,name:t.name,description:t.description||"",equipmentCount:t.equipements?t.equipements.length:0}));$(f)}T(!1)}).catch(a=>{console.error("Error fetching data:",a),T(!1)})}catch(s){console.error("Erreur lors du GET zones :",s),T(!1)}};r.useEffect(()=>{C()},[]);const l=h.filter(s=>s.name.toLowerCase().includes(z.toLowerCase())||s.description.toLowerCase().includes(z.toLowerCase())),E=Math.ceil(l.length/d),Z=(o-1)*d,U=Z+d,M=l.slice(Z,U);r.useEffect(()=>{g(1)},[z,d]),r.useEffect(()=>{const s=Math.ceil(l.length/d);l.length===0?g(1):s>0&&o>s&&g(s)},[l.length,d,o]);const[je,y]=r.useState(!1),[fe,R]=r.useState(!1),[c,D]=r.useState(null),[p,j]=r.useState({name:"",description:""}),we=async s=>{var a,f;s.preventDefault(),v(!0);try{if(c){$(h.map(B=>B.id===c.id?{...B,...p}:B));let t=typeof c.id=="string"&&c.id.includes("_")?c.id.split("_")[1]:c.id;const Ne=await L({method:"put",url:`/zones/${t}`,data:p});await C(),m(Ne?{title:"Zone modifiée",description:"La zone a été mise à jour avec succès."}:{title:"Échec de la mise à jour",variant:"destructive"})}else{const t=await L({method:"post",url:"/zones",data:p});await C(),m(t?{title:"Zone créée",description:"La nouvelle zone a été ajoutée avec succès."}:{title:"Échec de la création",variant:"destructive"})}y(!1),D(null),j({name:"",description:""})}catch(t){console.error("Error submitting zone:",t),m({title:"Erreur",description:((f=(a=t.response)==null?void 0:a.data)==null?void 0:f.message)||(c?"Erreur lors de la modification de la zone.":"Erreur lors de la création de la zone."),variant:"destructive"})}finally{v(!1)}},K=s=>{D(s),v(!1),j({name:s.name,description:s.description}),y(!0)},J=async s=>{var a,f;try{await L.delete(`/zones/${s}`),m({title:"Zone supprimée",description:"La zone a été supprimée avec succès."}),await C()}catch(t){console.error("Error deleting zone:",t),m({title:"Erreur",description:((f=(a=t.response)==null?void 0:a.data)==null?void 0:f.message)||"Erreur lors de la suppression de la zone.",variant:"destructive"})}},q=()=>{D(null),v(!1),j({name:"",description:""}),y(!0)},ge=()=>{try{const s=l.map(a=>({Nom:a.name,Description:a.description||"N/A","Nombre d'équipements":a.equipmentCount}));Ue(s,`zones_${new Date().toISOString().split("T")[0]}`),m({title:"Export réussi",description:"Les données ont été exportées avec succès."})}catch(s){console.error("Error exporting data:",s),m({title:"Erreur d'export",description:"Une erreur est survenue lors de l'export des données.",variant:"destructive"})}};return e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx(w,{className:"bg-card rounded-lg border",children:e.jsx(b,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words mb-1",children:"Gestion des Zones"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words mb-2",children:"Gérez les zones et leurs superviseurs"}),e.jsx(Ve,{children:e.jsxs(_e,{children:[e.jsx(xe,{children:e.jsx($e,{asChild:!0,children:e.jsx(Q,{to:"/",children:"Tableau de bord"})})}),e.jsx(He,{}),e.jsx(xe,{children:e.jsx(Ge,{children:"Zones"})})]})})]})]}),e.jsx(i,{variant:"outline",size:"icon",className:"flex-shrink-0 rounded-full w-10 h-10",asChild:!0,children:e.jsx(Q,{to:"/",children:e.jsx(Je,{className:"w-4 h-4"})})})]})})}),e.jsx(w,{className:"w-full box-border",children:e.jsx(b,{className:"p-4 sm:p-6 w-full min-w-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-center sm:items-center justify-between w-full min-w-0",children:[e.jsx("div",{className:"w-full sm:flex-1 min-w-0",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(be,{className:"absolute left-2 top-2.5 h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx(F,{id:"search",placeholder:"Nom ou description de la zone...",value:z,onChange:s=>pe(s.target.value),className:"pl-8 sm:pl-10 w-full text-sm"})]})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto flex-shrink-0",children:[e.jsxs(i,{onClick:()=>R(!0),variant:"outline",className:"gap-2 w-full sm:w-auto flex-shrink-0 text-sm",children:[e.jsx(Re,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Importer"}),e.jsx("span",{className:"sm:hidden",children:"Import"})]}),e.jsxs(i,{onClick:ge,variant:"outline",className:"gap-2 w-full sm:w-auto flex-shrink-0 text-sm",disabled:l.length===0,children:[e.jsx(Qe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporter"}),e.jsx("span",{className:"sm:hidden",children:"Export"})]}),e.jsxs(Ce,{open:je,onOpenChange:s=>{y(s),s||(D(null),v(!1),j({name:"",description:""}))},children:[e.jsx(ye,{asChild:!0,children:e.jsxs(i,{onClick:q,className:"gap-2 w-full sm:w-auto flex-shrink-0 text-sm",children:[e.jsx(_,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nouvelle Zone"}),e.jsx("span",{className:"sm:hidden",children:"Nouvelle"})]})}),e.jsxs(De,{className:"max-w-lg w-[95vw] sm:w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(ke,{className:"text-lg sm:text-xl",children:c?"Modifier la zone":"Créer une nouvelle zone"}),e.jsx(Ae,{className:"text-sm",children:c?"Modifiez les informations de la zone.":"Ajoutez une nouvelle zone au système."})]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(O,{htmlFor:"name",children:"Nom de la zone"}),e.jsx(F,{id:"name",value:p.name,onChange:s=>j({...p,name:s.target.value}),placeholder:"Ex: Zone de production A",required:!0})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(O,{htmlFor:"description",children:"Description"}),e.jsx(F,{id:"description",value:p.description,onChange:s=>j({...p,description:s.target.value}),placeholder:"Description de la zone",required:!0})]})}),e.jsxs(ze,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{y(!1),D(null),v(!1),j({name:"",description:""})},className:"w-full sm:w-auto",children:"Annuler"}),e.jsx(i,{type:"submit",className:"w-full sm:w-auto",disabled:G,children:G?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Modification...":"Création..."]}):c?"Modifier":"Créer"})]})]})]})]})]})]})})}),l.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 min-w-0 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(O,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap flex-shrink-0",children:"Éléments par page:"}),e.jsxs(Le,{value:d.toString(),onValueChange:s=>ue(Number(s)),children:[e.jsx(Pe,{className:"w-16 sm:w-20 flex-shrink-0 h-8 text-xs sm:text-sm",children:e.jsx(Ie,{})}),e.jsxs(Ze,{children:[e.jsx(S,{value:"3",children:"3"}),e.jsx(S,{value:"6",children:"6"}),e.jsx(S,{value:"9",children:"9"}),e.jsx(S,{value:"12",children:"12"}),e.jsx(S,{value:"15",children:"15"})]})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-1 border rounded-md p-0.5",children:[e.jsx(i,{variant:N==="grid"?"default":"ghost",size:"sm",onClick:()=>H("grid"),className:"h-7",title:"Vue grille",children:e.jsx(We,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(i,{variant:N==="table"?"default":"ghost",size:"sm",onClick:()=>H("table"),className:"h-7",title:"Vue tableau",children:e.jsx(Xe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-left",children:["Affichage de ",Z+1," à ",Math.min(U,l.length)," sur ",l.length," zone",l.length>1?"s":""]})]}),I?e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-3 md:gap-4 w-full min-w-0 ${N==="table"?"lg:hidden":""}`,children:Array.from({length:d}).map((s,a)=>e.jsxs(w,{className:"flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(P,{className:"pb-4 p-6 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx(n,{className:"w-3.5 h-3.5 rounded-full"}),e.jsx(n,{className:"h-3 w-20"})]}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx(n,{className:"h-6 w-6"}),e.jsx(n,{className:"h-6 w-6"})]})]}),e.jsx(n,{className:"h-3 w-full mt-1.5"})]}),e.jsx(b,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"h-3 w-16"}),e.jsx(n,{className:"h-4 w-10"})]})})]},a))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-3 md:gap-4 w-full min-w-0 ${N==="table"?"lg:hidden":""}`,children:M.map(s=>e.jsxs(w,{className:"hover:shadow-lg transition-shadow flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(P,{className:"pb-4 p-6 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx(A,{className:"w-6 h-6 text-primary flex-shrink-0"}),e.jsx(X,{className:"text-lg truncate min-w-0",children:s.name})]}),e.jsxs("div",{className:"flex gap-0.5 flex-shrink-0",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>K(s),className:"h-6 w-6 p-0",title:"Modifier",children:e.jsx(he,{className:"w-3 h-3"})}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-destructive hover:text-destructive",title:"Supprimer",children:e.jsx(se,{className:"w-3 h-3"})})}),e.jsxs(ae,{className:"w-[95vw] max-w-md",children:[e.jsxs(te,{children:[e.jsx(le,{className:"text-base sm:text-lg",children:"Supprimer la zone"}),e.jsxs(re,{className:"text-sm",children:['Êtes-vous sûr de vouloir supprimer la zone "',s.name,'" ? Cette action est irréversible.']})]}),e.jsxs(ie,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(ne,{className:"w-full sm:w-auto text-sm",children:"Annuler"}),e.jsx(ce,{onClick:()=>J(s.id),className:"w-full sm:w-auto text-sm",children:"Supprimer"})]})]})]})]})]}),e.jsx(Ee,{className:"text-xs line-clamp-2 mt-1.5",children:s.description})]}),e.jsx(b,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Équipements:"}),e.jsx(W,{variant:"secondary",className:"text-xs flex-shrink-0",children:s.equipmentCount})]})})]},s.id))}),N==="table"&&e.jsxs(w,{className:"w-full min-w-0 box-border hidden lg:block",children:[e.jsx(P,{className:"p-3 sm:p-4",children:e.jsxs(X,{className:"text-sm sm:text-base",children:["Zones (",l.length,")"]})}),e.jsx(b,{className:"p-0 sm:p-3 w-full min-w-0 overflow-hidden",children:e.jsx("div",{className:"w-full min-w-0",children:e.jsxs(me,{className:"w-full",children:[e.jsx(oe,{children:e.jsxs(k,{children:[e.jsx(u,{className:"text-xs sm:text-sm",children:"Nom"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Description"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Équipements"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Actions"})]})}),e.jsx(de,{children:M.length===0?e.jsx(k,{children:e.jsxs(x,{colSpan:4,className:"text-center py-6 sm:py-8",children:[e.jsx(A,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:h.length===0?"Aucune zone":"Aucun résultat"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:h.length===0?"Commencez par créer votre première zone.":"Aucune zone ne correspond à vos critères de recherche."}),h.length===0&&e.jsxs(i,{onClick:q,className:"w-full sm:w-auto",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Créer une zone"]})]})}):M.map(s=>e.jsxs(k,{children:[e.jsx(x,{className:"font-medium text-sm max-w-[150px] sm:max-w-none",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(A,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.name})]})}),e.jsx(x,{className:"text-sm max-w-xs truncate min-w-0",children:s.description}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(W,{variant:"secondary",className:"text-xs sm:text-sm",children:s.equipmentCount})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>K(s),className:"h-8 w-8 p-0",title:"Modifier",children:e.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive",title:"Supprimer",children:e.jsx(se,{className:"h-3 w-3 sm:h-4 sm:w-4"})})}),e.jsxs(ae,{className:"w-[95vw] max-w-md",children:[e.jsxs(te,{children:[e.jsx(le,{className:"text-base sm:text-lg",children:"Supprimer la zone"}),e.jsxs(re,{className:"text-sm",children:['Êtes-vous sûr de vouloir supprimer la zone "',s.name,'" ? Cette action est irréversible.']})]}),e.jsxs(ie,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(ne,{className:"w-full sm:w-auto text-sm",children:"Annuler"}),e.jsx(ce,{onClick:()=>J(s.id),className:"w-full sm:w-auto text-sm",children:"Supprimer"})]})]})]})]})})]},s.id))})]})})})]})]}),I&&N==="table"&&e.jsxs(w,{className:"w-full min-w-0 box-border hidden lg:block",children:[e.jsx(P,{className:"p-3 sm:p-4",children:e.jsx(n,{className:"h-5 w-32"})}),e.jsx(b,{className:"p-0 sm:p-3 w-full min-w-0 overflow-hidden",children:e.jsx("div",{className:"w-full min-w-0",children:e.jsxs(me,{className:"w-full",children:[e.jsx(oe,{children:e.jsxs(k,{children:[e.jsx(u,{className:"text-xs sm:text-sm",children:"Nom"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Description"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Équipements"}),e.jsx(u,{className:"text-xs sm:text-sm",children:"Actions"})]})}),e.jsx(de,{children:Array.from({length:d}).map((s,a)=>e.jsxs(k,{children:[e.jsx(x,{children:e.jsx(n,{className:"h-4 w-24"})}),e.jsx(x,{children:e.jsx(n,{className:"h-4 w-32"})}),e.jsx(x,{children:e.jsx(n,{className:"h-5 w-12"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{className:"h-8 w-8"}),e.jsx(n,{className:"h-8 w-8"})]})})]},a))})]})})})]}),!I&&l.length===0&&e.jsxs(w,{className:"p-6 sm:p-12 text-center",children:[e.jsx(A,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:h.length===0?"Aucune zone":"Aucun résultat"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:h.length===0?"Commencez par créer votre première zone.":"Aucune zone ne correspond à vos critères de recherche."}),h.length===0&&e.jsxs(i,{onClick:q,className:"w-full sm:w-auto",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Créer une zone"]})]}),l.length>0&&E>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full min-w-0 overflow-x-hidden",children:e.jsx(Me,{children:e.jsxs(qe,{className:"flex-wrap min-w-0",children:[e.jsx(V,{children:e.jsx(Be,{href:"#",onClick:s=>{s.preventDefault(),o>1&&g(o-1)},className:o===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:E},(s,a)=>a+1).map(s=>e.jsx(V,{children:e.jsx(Fe,{href:"#",onClick:a=>{a.preventDefault(),g(s)},isActive:o===s,className:"cursor-pointer",children:s})},s)),e.jsx(V,{children:e.jsx(Oe,{href:"#",onClick:s=>{s.preventDefault(),o<E&&g(o+1)},className:o===E?"pointer-events-none opacity-50":"cursor-pointer"})})]})})}),e.jsx(Ke,{open:fe,onOpenChange:R,importType:"zones",onImportSuccess:()=>{C(),m({title:"Import réussi",description:"Les zones ont été importées avec succès."})}})]})};export{fs as default};
