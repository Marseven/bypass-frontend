import{i as V,r as o,_ as W,l as F,j as e,P as A,o as U,aD as X,d as N,a9 as Y,e as C,aB as $,L as k,B as S}from"./index-6KXt54Ri.js";import{C as E,a as P,b as G,c as J,d as K}from"./card-Qkm_iOlj.js";import{u as Q}from"./index-B8b7maOM.js";import{L as Z}from"./label-BVuo7SAE.js";import{B as ee,a as se,b as y,c as _,d as B,e as te}from"./breadcrumb-CQcBmdJW.js";import{A as ae}from"./arrow-left-BsamjYhV.js";import{S as re}from"./save-63VesCay.js";var g="Switch",[ne,be]=V(g),[ce,ie]=ne(g),L=o.forwardRef((r,c)=>{const{__scopeSwitch:n,name:i,checked:d,defaultChecked:h,required:l,disabled:s,value:t="on",onCheckedChange:a,form:p,...m}=r,[u,b]=o.useState(null),M=W(c,x=>b(x)),j=o.useRef(!1),w=u?p||!!u.closest("form"):!0,[f=!1,O]=F({prop:d,defaultProp:h,onChange:a});return e.jsxs(ce,{scope:n,checked:f,disabled:s,children:[e.jsx(A.button,{type:"button",role:"switch","aria-checked":f,"aria-required":l,"data-state":H(f),"data-disabled":s?"":void 0,disabled:s,value:t,...m,ref:M,onClick:U(r.onClick,x=>{O(D=>!D),w&&(j.current=x.isPropagationStopped(),j.current||x.stopPropagation())})}),w&&e.jsx(oe,{control:u,bubbles:!j.current,name:i,value:t,checked:f,required:l,disabled:s,form:p,style:{transform:"translateX(-100%)"}})]})});L.displayName=g;var T="SwitchThumb",z=o.forwardRef((r,c)=>{const{__scopeSwitch:n,...i}=r,d=ie(T,n);return e.jsx(A.span,{"data-state":H(d.checked),"data-disabled":d.disabled?"":void 0,...i,ref:c})});z.displayName=T;var oe=r=>{const{control:c,checked:n,bubbles:i=!0,...d}=r,h=o.useRef(null),l=Q(n),s=X(c);return o.useEffect(()=>{const t=h.current,a=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(a,"checked").set;if(l!==n&&m){const u=new Event("click",{bubbles:i});m.call(t,n),t.dispatchEvent(u)}},[l,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...d,tabIndex:-1,ref:h,style:{...r.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function H(r){return r?"checked":"unchecked"}var I=L,de=z;const q=o.forwardRef(({className:r,...c},n)=>e.jsx(I,{className:N("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...c,ref:n,children:e.jsx(de,{className:N("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));q.displayName=I.displayName;const R=[{key:"request_created",label:"Nouvelle demande"},{key:"validation_result",label:"Résultat validation"},{key:"expiration_warning",label:"Alerte expiration"},{key:"reminder",label:"Rappels"}],v=[{key:"email",label:"Email"},{key:"whatsapp",label:"WhatsApp"},{key:"in_app",label:"Application"}],je=()=>{const{toast:r}=Y(),[c,n]=o.useState(!1),[i,d]=o.useState(()=>{const s={};return R.forEach(t=>{s[t.key]={},v.forEach(a=>{s[t.key][a.key]=!0})}),s});o.useEffect(()=>{C.get("/notification-preferences").then(s=>{if(Array.isArray(s.data)){const t={...i};s.data.forEach(a=>{t[a.event_type]&&(t[a.event_type][a.channel]=a.enabled)}),d(t)}}).catch(()=>{})},[]);const h=(s,t)=>{d(a=>({...a,[s]:{...a[s],[t]:!a[s][t]}}))},l=async()=>{var s,t;n(!0);try{const a=[];Object.entries(i).forEach(([p,m])=>{Object.entries(m).forEach(([u,b])=>{a.push({channel:u,event_type:p,enabled:b})})}),await C.put("/notification-preferences",{preferences:a}),r({title:"Préférences sauvegardées",description:"Vos préférences de notifications ont été mises à jour."})}catch(a){r({title:"Erreur",description:((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erreur lors de la sauvegarde.",variant:"destructive"})}finally{n(!1)}};return e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx(E,{className:"bg-card rounded-lg border",children:e.jsx(P,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words mb-1",children:"Préférences de notifications"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words mb-2",children:"Configurez vos canaux de notification"}),e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(y,{children:e.jsx(_,{asChild:!0,children:e.jsx(k,{to:"/",children:"Tableau de bord"})})}),e.jsx(B,{}),e.jsx(y,{children:e.jsx(_,{asChild:!0,children:e.jsx(k,{to:"/settings",children:"Paramètres"})})}),e.jsx(B,{}),e.jsx(y,{children:e.jsx(te,{children:"Notifications"})})]})})]})]}),e.jsx(S,{variant:"outline",size:"icon",className:"flex-shrink-0 rounded-full w-10 h-10",asChild:!0,children:e.jsx(k,{to:"/settings",children:e.jsx(ae,{className:"w-4 h-4"})})})]})})}),e.jsxs(E,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Canaux par type d'événement"}),e.jsx(K,{children:"Activez ou désactivez les canaux de notification pour chaque type d'événement."})]}),e.jsxs(P,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"Type d'événement"}),v.map(s=>e.jsx("th",{className:"text-center py-3 px-4 text-sm font-medium text-muted-foreground",children:s.label},s.key))]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx(Z,{className:"text-sm font-medium",children:s.label})}),v.map(t=>{var a;return e.jsx("td",{className:"text-center py-4 px-4",children:e.jsx(q,{checked:((a=i[s.key])==null?void 0:a[t.key])??!0,onCheckedChange:()=>h(s.key,t.key)})},t.key)})]},s.key))})]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(S,{onClick:l,className:"gap-2",disabled:c,children:[e.jsx(re,{className:"w-4 h-4"}),c?"Sauvegarde...":"Sauvegarder les préférences"]})})]})]})]})};export{je as default};
