import{c as V,a9 as D,t as G,r as o,v as O,e as m,j as e,aa as j,s as v,B as b,E as H,w as U}from"./index-BeE9M12_.js";import{u as $,g as J,h as K,F as y,a as N,b as w,c as L,d as E,o as Q,s as C}from"./form-BUqSUlKD.js";import{C as W,b as X,c as Y,d as Z,a as ee}from"./card-DyHadcFO.js";import{E as se}from"./eye-off-D60_Y1j8.js";import"./label-z1GT0630.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=V("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),te=Q({username:C({required_error:"L'identifiant est requis"}).min(1,"L'identifiant est requis"),password:C().min(1,"Le mot de passe est requis")});function de(){const{toast:l}=D(),p=G(),[r,d]=o.useState(!1),[u,S]=o.useState(!1),{user:F,token:_,login:k}=O(),[M,I]=o.useState("MineSafe OS"),[q,z]=o.useState("Connectez-vous pour acceder au systeme de gestion des bypass");o.useEffect(()=>{m.get("/settings/public").then(s=>{var n,i;(n=s.data)!=null&&n.app_name&&I(s.data.app_name),(i=s.data)!=null&&i.app_tagline&&z(s.data.app_tagline)}).catch(()=>{})},[]);const c=$({resolver:J(te),defaultValues:{username:"",password:""}});if(_)return F.role==="user"?e.jsx(j,{to:"/requests/new",replace:!0}):e.jsx(j,{to:"/",replace:!0});const T=async s=>{var n,i;d(!0);try{const a=await m({method:"post",url:"/auth/login",data:s});if(console.log("Success:",a.data.data),a.data.data.length!==0){k(a.data.data.user,a.data.data.token),l({title:"Connexion reussie",description:"Vous etes maintenant connecte.",variant:"success"});try{const A=((await m.get("/notifications")).data||[]).filter(t=>!t.read_at),B=t=>({preventive_maintenance:"Maintenance preventive",corrective_maintenance:"Maintenance corrective",calibration:"Etalonnage",testing:"Tests",emergency_repair:"Reparation d'urgence",system_upgrade:"Mise a niveau systeme",investigation:"Investigation",other:"Autre"})[t]||t;A.forEach((t,f)=>{setTimeout(()=>{var g,h;const P=(g=t.data)!=null&&g.title?B(t.data.title):"Nouvelle notification",R=((h=t.data)==null?void 0:h.description)||"Vous avez une nouvelle notification";l({title:P,description:R,duration:5e3,variant:"info"})},f*600)})}catch(x){console.error("Error fetching notifications:",x)}a.data.data.user.role==="user"?p("/requests/new",{replace:!0}):p("/",{replace:!0})}else console.log("Login failed: ",a.data),l({title:"Echec de la connexion",description:"Email ou mot de passe incorrect.",variant:"destructive"}),d(!1)}catch(a){console.error("Error:",a),l({title:"Erreur",description:((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||"Une erreur est survenue lors de la connexion.",variant:"destructive"}),d(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background bg-grid-pattern p-6 relative",children:[e.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[400px] bg-primary/5 rounded-full blur-[120px] pointer-events-none"}),r&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center w-32 h-32",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-primary/10 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary border-r-primary rounded-full animate-spin",style:{animationDuration:"1s"}}),e.jsx("div",{className:"relative z-10 w-20 h-20 flex items-center justify-center bg-card rounded-xl p-3 shadow-lg",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard",className:"w-full h-full object-contain"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-foreground",children:"Connexion en cours..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Veuillez patienter"})]})]})}),e.jsxs(W,{variant:"glass",className:`w-full max-w-md border-border/30 relative ${r?"opacity-50 pointer-events-none":""}`,children:[e.jsxs(X,{className:"space-y-1 text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-18 mx-auto mb-4",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard"})}),e.jsx(Y,{className:"text-2xl font-display font-bold text-gradient-primary",children:M}),e.jsx(Z,{children:q})]}),e.jsx(ee,{children:e.jsx(K,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(T),className:"space-y-4",children:[e.jsx(y,{control:c.control,name:"username",render:({field:s})=>e.jsxs(N,{children:[e.jsx(w,{children:"Email"}),e.jsx(L,{children:e.jsx(v,{type:"text",placeholder:"administrateur",disabled:r,...s})}),e.jsx(E,{})]})}),e.jsx(y,{control:c.control,name:"password",render:({field:s})=>e.jsxs(N,{children:[e.jsx(w,{children:"Mot de passe"}),e.jsx(L,{children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{type:u?"text":"password",placeholder:"••••••••",disabled:r,...s}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>S(!u),disabled:r,children:u?e.jsx(se,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})]})}),e.jsx(E,{})]})}),e.jsx(b,{type:"submit",className:"w-full font-display tracking-wide",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Connexion en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Se connecter"]})})]})})})]})]})}export{de as default};
