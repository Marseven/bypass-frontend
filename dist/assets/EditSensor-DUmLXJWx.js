import{ap as W,s as X,r,j as e,S as h,L as Y,Q as B,B as j,v as ee,E as se,q as k,e as p,J as x}from"./index-Cm5HjFIo.js";import{C as $,a as F}from"./card-C-b0mMpV.js";import{L as c}from"./label-BEIp1959.js";import{S as g,a as v,b as f,c as y,d as N}from"./select-BVacNl4j.js";import{T as ae}from"./triangle-alert-Dgevcf7d.js";import"./index-CJUiwxDA.js";const te=[{value:"temperature",label:"Transmetteur Température"},{value:"pressure",label:"Transmetteur Pression"},{value:"vibration",label:"Capteur Vibration"},{value:"flow",label:"Capteur Débit"},{value:"level",label:"Capteur Niveau"},{value:"speed",label:"Capteur Vitesse"},{value:"position",label:"Capteur Position"},{value:"other",label:"Autre"}],oe=()=>{var q,z,D;const{id:d}=W(),o=X(),[Z,b]=r.useState(!0),[S,_]=r.useState(!1),[t,J]=r.useState(null),[G,H]=r.useState([]),[M,O]=r.useState([]),[a,l]=r.useState({code:"",type:"",name:"",zone_id:"",equipment_id:"",unit:"",seuil_critique:""});r.useEffect(()=>{d&&(async()=>{var n,m,E,T,A;b(!0);try{const[L,V,I]=await Promise.all([p.get(`/sensors/${d}`),p.get("/zones"),p.get("/equipment")]),i=((n=L.data)==null?void 0:n.data)||L.data;J(i);const P=((m=V.data)==null?void 0:m.data)||V.data||[];H(Array.isArray(P)?P:[]);const R=((E=I.data)==null?void 0:E.data)||I.data||[];O(Array.isArray(R)?R:[]),l({code:i.code||"",type:i.type||"",name:i.name||"",zone_id:String(((A=(T=i.equipment)==null?void 0:T.zone)==null?void 0:A.id)||i.zone_id||""),equipment_id:String(i.equipment_id||""),unit:i.unite||i.unit||"",seuil_critique:String(i.seuil_critique||i.criticalThreshold||"")})}catch{x.error("Erreur lors du chargement du capteur"),o("/sensors")}b(!1)})()},[d]);const Q=async()=>{var s,n;if(!a.code||!a.type||!a.name){x.error("Veuillez remplir les champs obligatoires");return}_(!0);try{await p.put(`/sensors/${d}`,{code:a.code,type:a.type,name:a.name,equipment_id:a.equipment_id||void 0,unite:a.unit,seuil_critique:a.seuil_critique||void 0}),x.success("Capteur mis à jour"),o("/sensors")}catch(m){x.error(((n=(s=m.response)==null?void 0:s.data)==null?void 0:n.message)||"Erreur lors de la mise à jour")}_(!1)},U=((z=(q=t==null?void 0:t.equipment)==null?void 0:q.zone)==null?void 0:z.name)||"Zone",w=(t==null?void 0:t.code)||"",K=(t==null?void 0:t.status)==="bypassed",C=t!=null&&t.updated_at?new Date(t.updated_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):null,u=(t==null?void 0:t.active_bypass)||null;return Z?e.jsxs("div",{className:"w-full p-4 md:p-6 space-y-6",children:[e.jsx(h,{className:"h-5 w-64"}),e.jsx(h,{className:"h-10 w-96"}),e.jsx(h,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"w-full p-4 md:p-6 space-y-6 overflow-x-hidden",children:[e.jsxs("nav",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Y,{to:"/sensors",className:"hover:text-foreground transition-colors",children:"Inventaire"}),e.jsx(B,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:U}),e.jsx(B,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"text-foreground font-medium",children:["Éditer ",w]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground",children:["Éditer le Capteur : ",w]}),C&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Dernière modification le ",C]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{variant:"outline",onClick:()=>o("/sensors"),children:"Annuler"}),e.jsxs(j,{onClick:Q,disabled:S,children:[S&&e.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),"Enregistrer"]})]})]}),K&&e.jsx($,{className:"border-warning/30 bg-warning/5",children:e.jsxs(F,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-warning/20 flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Capteur actuellement en Bypass"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u?`Activé le ${new Date(u.start_date||u.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})} par ${((D=u.user)==null?void 0:D.name)||"N/A"}`:"Un bypass est actuellement actif sur ce capteur."})]})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>o("/requests/mine"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Voir le Bypass"]})]})}),e.jsx($,{children:e.jsxs(F,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Informations Générales"})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Identifiant du Tag ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(k,{value:a.code,onChange:s=>l({...a,code:s.target.value}),placeholder:"PT-3042"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Type d'équipement ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(g,{value:a.type,onValueChange:s=>l({...a,type:s}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Sélectionner un type"})}),e.jsx(y,{children:te.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Description ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(k,{value:a.name,onChange:s=>l({...a,name:s.target.value}),placeholder:"Pression Huile Concasseur Primaire"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Zone d'installation ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(g,{value:a.zone_id,onValueChange:s=>{l({...a,zone_id:s,equipment_id:""})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Sélectionner une zone"})}),e.jsx(y,{children:G.map(s=>e.jsx(N,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Sous-système"}),e.jsxs(g,{value:a.equipment_id,onValueChange:s=>l({...a,equipment_id:s}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Sélectionner un équipement"})}),e.jsx(y,{children:M.filter(s=>{var n;return!a.zone_id||String(((n=s.zone)==null?void 0:n.id)||s.zone_id)===a.zone_id}).map(s=>e.jsxs(N,{value:String(s.id),children:[s.name," (",s.code,")"]},s.id))})]})]})]})]})]})})]})};export{oe as default};
