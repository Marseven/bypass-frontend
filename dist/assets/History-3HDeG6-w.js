import{x as de,O as me,r as n,e as xe,j as e,Q as X,L as G,B as k,y as ue,s as he,S as i,M as K,h as fe,R as je,z as U,T as Z}from"./index-BMrJ7TPv.js";import{C as b,a as y,c as pe}from"./card-Czu7AEdR.js";import{L as ee}from"./label-Lykqkk46.js";import{S as F,a as E,b as H,c as R,d as r}from"./select-CXDll5YJ.js";import{P as ge,a as we,b as C,c as Ne,d as se,e as ve}from"./pagination-CkTVS_P0.js";import{B as be,a as ye,b as te,c as Ce,d as De,e as Se}from"./breadcrumb-DvOId1w-.js";import{P as Pe,a as Le,f as ke,b as Ae,C as _e,c as qe}from"./popover-CDqssv7X.js";import{A as Me}from"./arrow-left-Cbv8asXn.js";import{D as Te}from"./download-CiA4VGO7.js";import{C as Fe}from"./calendar-IAHkNgT4.js";import{C as B}from"./circle-check-big-Xu-lCym7.js";import{F as ae}from"./file-text-Cv_vV0lJ.js";import{C as re}from"./clock-B5us2zq3.js";import"./index-BHZ4bV--.js";function Ge(){const le=de(),D=me(),[f,I]=n.useState(""),[S,O]=n.useState("all"),[x,z]=n.useState("all"),[o,A]=n.useState(void 0),[_,ne]=n.useState([]),[c,p]=n.useState(1),[j,ce]=n.useState(3),[V,q]=n.useState(!0),ie=s=>{const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(s){case"today":return{start:l,end:new Date(l.getTime()+24*60*60*1e3-1)};case"week":const a=new Date(l),d=l.getDay(),h=d===0?6:d-1;a.setDate(l.getDate()-h),a.setHours(0,0,0,0);const m=new Date(a);return m.setDate(a.getDate()+6),m.setHours(23,59,59,999),{start:a,end:m};case"month":const w=new Date(t.getFullYear(),t.getMonth(),1);w.setHours(0,0,0,0);const L=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999);return{start:w,end:L};case"custom":if(o){const N=new Date(o);N.setHours(0,0,0,0);const v=new Date(o);return v.setHours(23,59,59,999),{start:N,end:v}}return null;default:return null}},u=(_??[]).filter(s=>{var d,h,m,w,L,N,v;const t=((h=(d=s.equipment)==null?void 0:d.name)==null?void 0:h.toLowerCase().includes(f.toLowerCase()))||((w=(m=s.sensor)==null?void 0:m.name)==null?void 0:w.toLowerCase().includes(f.toLowerCase()))||((L=s.request_code)==null?void 0:L.toLowerCase().includes(f.toLowerCase()))||((v=(N=s.requester)==null?void 0:N.full_name)==null?void 0:v.toLowerCase().includes(f.toLowerCase())),l=S==="all"||s.status===S;let a=!0;if(x!=="all"){const T=ie(x);if(T&&s.created_at){const Q=new Date(s.created_at);a=Q>=T.start&&Q<=T.end}else x==="custom"&&!o?a=!0:a=!1}return t&&l&&a}),g=Math.ceil(u.length/j),M=(c-1)*j,$=M+j,W=u.slice(M,$);n.useEffect(()=>{p(1)},[f,S,x,o,j]),n.useEffect(()=>{x!=="custom"&&A(void 0)},[x]);const oe=s=>{switch(s){case"En attente":return"bg-warning text-warning-foreground";case"pending":return"bg-warning text-warning-foreground";case"Approuvé":return"bg-success text-success-foreground";case"approved":return"bg-success text-success-foreground";case"En cours":return"bg-primary text-primary-foreground";case"in_progress":return"bg-primary text-primary-foreground";default:return"bg-muted text-muted-foreground"}},Y=s=>{switch(s){case"En attente":return e.jsx(re,{className:"w-4 h-4"});case"pending":return e.jsx(re,{className:"w-4 h-4"});case"Approuvé":return e.jsx(B,{className:"w-4 h-4"});case"approved":return e.jsx(B,{className:"w-4 h-4"});case"En cours":return e.jsx(Z,{className:"w-4 h-4"});case"in_progress":return e.jsx(Z,{className:"w-4 h-4"});case"Rejeté":return e.jsx(U,{className:"w-4 h-4"});case"rejected":return e.jsx(U,{className:"w-4 h-4"});default:return e.jsx(ae,{className:"w-4 h-4"})}},P=s=>{switch(s){case"director":return"Approbateur N2";case"supervisor":return"Approbateur N1";case"user":return"Demandeur";case"administrator":return"Administrateur";default:return s||""}};n.useEffect(()=>{q(!0),xe.get("/dashboard/recent-requests").then(s=>{console.log(s.data),ne(s.data),q(!1)}).catch(s=>{console.error("Error fetching data:",s),q(!1)})},[le.key]);const J=(s,t)=>{const l=new Date(s),a=new Date(t);return(l.getTime()-a.getTime())/(1e3*60*60)};return e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx(b,{className:"bg-card rounded-lg border",children:e.jsx(y,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words mb-1",children:"Historique des demandes"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words mb-2",children:"Journal d'audit et historique des validations"}),e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(te,{children:e.jsx(Ce,{asChild:!0,children:e.jsx(G,{to:"/",children:"Tableau de bord"})})}),e.jsx(De,{}),e.jsx(te,{children:e.jsx(Se,{children:"Historique"})})]})})]})]}),e.jsx(k,{variant:"outline",size:"icon",className:"flex-shrink-0 rounded-full w-10 h-10",asChild:!0,children:e.jsx(G,{to:"/",children:e.jsx(Me,{className:"w-4 h-4"})})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{variant:"outline",size:D?"sm":"default",className:"gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Exporter"})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"relative sm:col-span-2 lg:col-span-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground z-10"}),e.jsx(he,{placeholder:"Rechercher...",value:f,onChange:s=>I(s.target.value),className:"pl-10 w-full text-sm sm:text-base"})]}),e.jsxs(F,{value:S,onValueChange:O,children:[e.jsx(E,{className:"w-full text-sm sm:text-base",children:e.jsx(H,{placeholder:"Statut"})}),e.jsxs(R,{children:[e.jsx(r,{value:"all",children:"Tous les statuts"}),e.jsx(r,{value:"pending",children:"En attente"}),e.jsx(r,{value:"in_progress",children:"En cours"}),e.jsx(r,{value:"approved",children:"Approuvé"}),e.jsx(r,{value:"rejected",children:"Rejeté"})]})]}),e.jsxs(F,{value:x,onValueChange:z,children:[e.jsx(E,{className:"w-full text-sm sm:text-base",children:e.jsx(H,{placeholder:"Période"})}),e.jsxs(R,{children:[e.jsx(r,{value:"all",children:"Toutes les périodes"}),e.jsx(r,{value:"today",children:"Aujourd'hui"}),e.jsx(r,{value:"week",children:"Cette semaine"}),e.jsx(r,{value:"month",children:"Ce mois"}),e.jsx(r,{value:"custom",children:"Personnalisée"})]})]}),e.jsx(k,{variant:"outline",onClick:()=>{I(""),O("all"),z("all"),A(void 0)},className:"w-full sm:w-auto text-sm sm:text-base",size:D?"sm":"default",children:"Réinitialiser"})]}),x==="custom"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[e.jsx(ee,{className:"text-sm",children:"Sélectionner une date"}),e.jsxs(Pe,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:`w-full justify-start text-left font-normal text-sm sm:text-base ${!o&&"text-muted-foreground"}`,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),o?ke(o,"PPP",{locale:qe}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Ae,{className:"w-auto p-0",align:"start",children:e.jsx(_e,{mode:"single",selected:o,onSelect:A,initialFocus:!0})})]})]})})]})}),!V&&u.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 w-full sm:w-auto",children:e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(ee,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap",children:"Éléments par page:"}),e.jsxs(F,{value:j.toString(),onValueChange:s=>ce(Number(s)),children:[e.jsx(E,{className:"w-16 sm:w-20 md:w-24 text-sm",children:e.jsx(H,{})}),e.jsxs(R,{children:[e.jsx(r,{value:"3",children:"3"}),e.jsx(r,{value:"6",children:"6"}),e.jsx(r,{value:"9",children:"9"}),e.jsx(r,{value:"12",children:"12"}),e.jsx(r,{value:"15",children:"15"})]})]})]})}),e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground text-left sm:text-right w-full sm:w-auto",children:["Affichage de ",M+1," à ",Math.min($,u.length)," sur ",u.length," demande",u.length>1?"s":""]})]}),V?e.jsx("div",{className:"space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:Array.from({length:j}).map((s,t)=>e.jsx(b,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(y,{className:"p-4 sm:p-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx(i,{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(i,{className:"h-5 w-32 mb-2"}),e.jsx(i,{className:"h-4 w-20 mb-2"}),e.jsx(i,{className:"h-3 w-40 mb-1"}),e.jsx(i,{className:"h-3 w-36"})]})]}),e.jsxs("div",{className:"flex flex-row gap-3 sm:gap-4 flex-1 min-w-0 items-center sm:items-center justify-between flex-wrap",children:[e.jsx(i,{className:"h-3 w-40"}),e.jsx(i,{className:"h-3 w-40"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(i,{className:"h-4 w-32"}),e.jsx(K,{className:"my-1"}),e.jsxs("div",{className:"flex flex-row justify-between items-center gap-4",children:[e.jsx(i,{className:"h-3 w-28"}),e.jsx(i,{className:"h-4 w-24"})]})]})]})})})},t))}):W.length===0?e.jsx(b,{className:"w-full box-border",children:e.jsxs(y,{className:"text-center py-6 sm:py-8",children:[e.jsx(X,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-2",children:_.length===0?"Aucune demande":"Aucun résultat"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:_.length===0?"Aucune demande dans l'historique.":"Aucune demande ne correspond à vos critères de recherche."})]})}):e.jsx("div",{className:"space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:W.map(s=>{var t,l,a,d,h,m;return e.jsx(b,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(y,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex-shrink-0",children:e.jsx("div",{className:"text-blue-600",children:s.status==="Approuvé"||s.status==="approved"?e.jsx(B,{className:"w-5 h-5 sm:w-6 sm:h-6"}):Y(s.status)?e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6",children:Y(s.status)}):e.jsx(ae,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(pe,{className:"text-base sm:text-lg font-bold truncate min-w-0",children:s.request_code}),e.jsx(fe,{className:oe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((t=s.equipment)==null?void 0:t.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((l=s.sensor)==null?void 0:l.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"flex flex-row gap-3 sm:gap-4 flex-1 min-w-0 items-center sm:items-center justify-between flex-wrap",children:[e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap",children:["Demande: ",new Date(s.created_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),s.validated_at&&e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap",children:["Validation: ",new Date(s.validated_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-left",children:[((a=s.requester)==null?void 0:a.role)&&P(s.requester.role)&&e.jsxs("span",{className:"text-muted-foreground font-normal",children:[P(s.requester.role),": "]}),((d=s.requester)==null?void 0:d.full_name)||"N/A"]}),e.jsx(K,{className:"my-1"}),e.jsxs("div",{className:"flex flex-row justify-between items-center gap-4",children:[((h=s.validator)==null?void 0:h.full_name)&&e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground text-left",children:[((m=s.validator)==null?void 0:m.role)&&P(s.validator.role)&&e.jsxs("span",{children:[P(s.validator.role),": "]}),s.validator.full_name]}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground whitespace-nowrap text-right ml-auto",children:["Durée: ",Math.round(J(s.end_time,s.start_time))," Heure",Math.round(J(s.end_time,s.start_time))>1?"s":""]})]})]})]})})},s.id)})}),u.length>0&&g>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full",children:e.jsx(ge,{children:e.jsxs(we,{className:"flex-wrap gap-1 sm:gap-2",children:[e.jsx(C,{children:e.jsx(Ne,{href:"#",onClick:s=>{s.preventDefault(),c>1&&p(c-1)},className:c===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:g},(s,t)=>t+1).filter(s=>D?s===1||s===g||Math.abs(s-c)<=1:!0).map((s,t,l)=>D&&t>0&&s-l[t-1]>1?e.jsxs(je.Fragment,{children:[e.jsx(C,{children:e.jsx("span",{className:"px-2 text-muted-foreground",children:"..."})}),e.jsx(C,{children:e.jsx(se,{href:"#",onClick:a=>{a.preventDefault(),p(s)},isActive:c===s,className:"cursor-pointer text-xs sm:text-sm",children:s})},s)]},`ellipsis-${s}`):e.jsx(C,{children:e.jsx(se,{href:"#",onClick:a=>{a.preventDefault(),p(s)},isActive:c===s,className:"cursor-pointer text-xs sm:text-sm min-w-[2rem] sm:min-w-[2.5rem]",children:s})},s)),e.jsx(C,{children:e.jsx(ve,{href:"#",onClick:s=>{s.preventDefault(),c<g&&p(c+1)},className:c===g?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})}export{Ge as default};
