import{c as cs,i as Js,k as ws,r as h,u as Gs,l as Ys,j as e,m as Us,P as We,n as Ws,I as Zs,o as Ze,p as Ks,d as ue,C as Xs,e as se,h as P,q as je,B as M,X as Qs,s as Ns,t as ys,v as js,J as ke,D as Ke,w as qs,E as ea,x as Xe,y as Qe,z as qe,A as es,U as sa,F as ps,G as aa,L as ss,H as Fe,S as i}from"./index-ZZsXg-G3.js";import{C as p,a as f,b as I,c as F,d as Ne}from"./card-BPQAkTZI.js";import{L as ce}from"./label-CPB5W1LU.js";import{S as k,a as D,b as L,c as T,d as a}from"./select-DiscjmYY.js";import{P as Re,a as Ee,b as ee,c as Ve,d as ze,e as Be}from"./pagination-BhbWPJO3.js";import{B as ta,a as la,b as fs,c as na,d as ia,e as ra}from"./breadcrumb-8314j59s.js";import{F as V,a as z,b as E,c as B,d as Y,o as ca,s as W,_ as ye,e as gs,f as vs,u as da,g as ma,h as oa}from"./form-CKwMMQUX.js";import{T as be}from"./textarea-BVYEev0-.js";import{C as ls}from"./checkbox-CObvmHOS.js";import{P as xa}from"./plus--hP3G2th.js";import{A as ns}from"./arrow-left-DrcLXUsQ.js";import{S as ha}from"./save-6RksvAHc.js";import{F as Z}from"./file-text-SqSQEDRB.js";import{T as Ue}from"./triangle-alert-DLKeRygy.js";import{C as Ae}from"./calendar-BjnMLmU6.js";import{M as ua}from"./map-pin-yvPTkTt-.js";import{C as is}from"./circle-x-CLnzrX78.js";import{a as de,C as rs}from"./clock-BQ08-VsH.js";import{P as Oe,a as $e,f as He,b as Je,C as Ge,c as Ye}from"./popover-DaliZX6S.js";import{F as as}from"./filter-DCpajVuM.js";import{A as ja}from"./activity-2r6O6yVp.js";import"./index-DOLWbsCs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=cs("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=cs("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=cs("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);var ds="Tabs",[va,it]=Js(ds,[ws]),bs=ws(),[wa,ms]=va(ds),Cs=h.forwardRef((t,r)=>{const{__scopeTabs:u,value:l,onValueChange:d,defaultValue:x,orientation:n="horizontal",dir:m,activationMode:v="automatic",...o}=t,y=Gs(m),[A,R]=Ys({prop:l,onChange:d,defaultProp:x});return e.jsx(wa,{scope:u,baseId:Us(),value:A,onValueChange:R,orientation:n,dir:y,activationMode:v,children:e.jsx(We.div,{dir:y,"data-orientation":n,...o,ref:r})})});Cs.displayName=ds;var Ss="TabsList",As=h.forwardRef((t,r)=>{const{__scopeTabs:u,loop:l=!0,...d}=t,x=ms(Ss,u),n=bs(u);return e.jsx(Ws,{asChild:!0,...n,orientation:x.orientation,dir:x.dir,loop:l,children:e.jsx(We.div,{role:"tablist","aria-orientation":x.orientation,...d,ref:r})})});As.displayName=Ss;var Is="TabsTrigger",_s=h.forwardRef((t,r)=>{const{__scopeTabs:u,value:l,disabled:d=!1,...x}=t,n=ms(Is,u),m=bs(u),v=Ls(n.baseId,l),o=Ts(n.baseId,l),y=l===n.value;return e.jsx(Zs,{asChild:!0,...m,focusable:!d,active:y,children:e.jsx(We.button,{type:"button",role:"tab","aria-selected":y,"aria-controls":o,"data-state":y?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:v,...x,ref:r,onMouseDown:Ze(t.onMouseDown,A=>{!d&&A.button===0&&A.ctrlKey===!1?n.onValueChange(l):A.preventDefault()}),onKeyDown:Ze(t.onKeyDown,A=>{[" ","Enter"].includes(A.key)&&n.onValueChange(l)}),onFocus:Ze(t.onFocus,()=>{const A=n.activationMode!=="manual";!y&&!d&&A&&n.onValueChange(l)})})})});_s.displayName=Is;var ks="TabsContent",Ds=h.forwardRef((t,r)=>{const{__scopeTabs:u,value:l,forceMount:d,children:x,...n}=t,m=ms(ks,u),v=Ls(m.baseId,l),o=Ts(m.baseId,l),y=l===m.value,A=h.useRef(y);return h.useEffect(()=>{const R=requestAnimationFrame(()=>A.current=!1);return()=>cancelAnimationFrame(R)},[]),e.jsx(Ks,{present:d||y,children:({present:R})=>e.jsx(We.div,{"data-state":y?"active":"inactive","data-orientation":m.orientation,role:"tabpanel","aria-labelledby":v,hidden:!R,id:o,tabIndex:0,...n,ref:r,style:{...t.style,animationDuration:A.current?"0s":void 0},children:R&&x})})});Ds.displayName=ks;function Ls(t,r){return`${t}-trigger-${r}`}function Ts(t,r){return`${t}-content-${r}`}var Na=Cs,Ps=As,Ms=_s,Fs=Ds;const ya=Na,Rs=h.forwardRef(({className:t,...r},u)=>e.jsx(Ps,{ref:u,className:ue("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));Rs.displayName=Ps.displayName;const Ie=h.forwardRef(({className:t,...r},u)=>e.jsx(Ms,{ref:u,className:ue("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r}));Ie.displayName=Ms.displayName;const _e=h.forwardRef(({className:t,...r},u)=>e.jsx(Fs,{ref:u,className:ue("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));_e.displayName=Fs.displayName;function ba({steps:t,currentStep:r,onStepClick:u}){return e.jsx("nav",{"aria-label":"Progress",className:"mb-8",children:e.jsx("ol",{className:"flex items-center",children:t.map((l,d)=>e.jsxs("li",{className:ue("relative flex-1",d!==t.length-1&&"pr-8 sm:pr-20"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",onClick:()=>u==null?void 0:u(l.id),disabled:l.id>r+1,className:ue("relative flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium transition-colors",l.id<r?"bg-primary text-primary-foreground cursor-pointer":l.id===r?"border-2 border-primary bg-background text-primary":"border-2 border-muted bg-background text-muted-foreground"),children:l.id<r?e.jsx(Xs,{className:"h-4 w-4"}):l.id}),d!==t.length-1&&e.jsx("div",{className:ue("absolute top-4 left-8 -ml-px h-0.5 w-full sm:left-20",l.id<r?"bg-primary":"bg-muted"),style:{width:"calc(100% - 2rem)"}})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:ue("text-xs font-medium",l.id<=r?"text-primary":"text-muted-foreground"),children:l.title})})]},l.id))})})}const Es={maintenance:"Maintenance",operationnel:"Opérationnel",permissif:"Permissif"},Vs={process:"Process",securite:"Sécurité"},zs={court_terme:"Court terme (< 48h)",long_terme:"Long terme (≥ 48h)"},Ca={na:"N/A",sil1:"SIL 1",sil2:"SIL 2",sil3:"SIL 3"},Sa={process:"Process",securite:"Sécurité",feu_gaz:"Feu & Gaz"};function Aa({form:t}){const[r,u]=h.useState([]),[l,d]=h.useState([]),[x,n]=h.useState([]),[m,v]=h.useState([]),[o,y]=h.useState(null),[A,R]=h.useState(null),K=t.watch("siteId"),U=t.watch("zoneId"),q=t.watch("equipmentId"),ae=t.watch("sensorId");return h.useEffect(()=>{se.get("/sites").then(j=>{u(j.data.data||[])}).catch(console.error)},[]),h.useEffect(()=>{K&&(se.get(`/zones?site_id=${K}`).then(j=>{d(j.data.data||[])}).catch(console.error),t.setValue("zoneId",""),t.setValue("equipmentId",""),t.setValue("sensorId",""),n([]),v([]))},[K]),h.useEffect(()=>{U&&(se.get(`/zones/${U}/equipements`).then(j=>{n(j.data||[])}).catch(console.error),t.setValue("equipmentId",""),t.setValue("sensorId",""),v([]))},[U]),h.useEffect(()=>{if(q){const j=x.find(N=>String(N.id)===String(q));y(j),j&&se.get(`/equipment/${j.id}/sensors`).then(N=>{v(N.data.data||[])}).catch(console.error),t.setValue("sensorId","")}},[q,x]),h.useEffect(()=>{if(ae){const j=m.find(N=>String(N.id)===String(ae));R(j)}},[ae,m]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(V,{control:t.control,name:"siteId",render:({field:j})=>e.jsxs(z,{children:[e.jsx(E,{children:"Site"}),e.jsxs(k,{onValueChange:j.onChange,value:j.value,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner un site"})})}),e.jsx(T,{children:r.map(N=>e.jsxs(a,{value:String(N.id),children:[N.code," - ",N.name]},N.id))})]}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"zoneId",render:({field:j})=>e.jsxs(z,{children:[e.jsx(E,{children:"Zone"}),e.jsxs(k,{onValueChange:j.onChange,value:j.value,disabled:!K,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner une zone"})})}),e.jsx(T,{children:l.map(N=>e.jsx(a,{value:String(N.id),children:N.name},N.id))})]}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"equipmentId",render:({field:j})=>e.jsxs(z,{children:[e.jsx(E,{children:"Equipement"}),e.jsxs(k,{onValueChange:j.onChange,value:j.value,disabled:!U,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner un équipement"})})}),e.jsx(T,{children:x.map(N=>e.jsxs(a,{value:String(N.id),children:[N.name," (",N.code,")"]},N.id))})]}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"sensorId",render:({field:j})=>e.jsxs(z,{children:[e.jsx(E,{children:"Capteur"}),e.jsxs(k,{onValueChange:j.onChange,value:j.value,disabled:!q,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner un capteur"})})}),e.jsx(T,{children:m.map(N=>e.jsxs(a,{value:String(N.id),children:[N.name," (",N.code,")"]},N.id))})]}),e.jsx(Y,{})]})})]}),o&&e.jsx(p,{children:e.jsxs(f,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Informations de l'équipement"}),o.niveau_sil&&o.niveau_sil!=="na"&&e.jsx(P,{variant:"destructive",children:Ca[o.niveau_sil]||o.niveau_sil})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",o.type]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Criticité:"})," ",o.criticite]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Système:"})," ",Sa[o.type_systeme]||o.type_systeme||"Process"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Fabricant:"})," ",o.fabricant]})]}),o.fonction_securite&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fonction sécurité:"})," ",o.fonction_securite]})]})}),A&&e.jsx(p,{children:e.jsxs(f,{className:"pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Informations du capteur"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",A.type]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Unité:"})," ",A.unit]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Statut:"})," ",A.status]}),A.critical_threshold&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Seuil critique:"})," ",A.critical_threshold]})]})]})})]})}const Ia=[{value:"preventive_maintenance",label:"Maintenance préventive"},{value:"corrective_maintenance",label:"Maintenance corrective"},{value:"calibration",label:"Étalonnage capteur"},{value:"testing",label:"Test de fonctionnement"},{value:"emergency_repair",label:"Réparation urgente"},{value:"system_upgrade",label:"Mise à niveau système"},{value:"investigation",label:"Investigation"},{value:"other",label:"Autre"}],_a=[{value:"low",label:"Faible"},{value:"normal",label:"Normale"},{value:"high",label:"Élevée"},{value:"critical",label:"Critique"},{value:"emergency",label:"Urgence"}],ka=[{value:"very_low",label:"Très faible"},{value:"low",label:"Faible"},{value:"medium",label:"Moyen"},{value:"high",label:"Élevé"},{value:"very_high",label:"Très élevé"}],Da=[{id:"visual_inspection",label:"Inspection visuelle renforcée"},{id:"portable_detector",label:"Détecteur portable en place"},{id:"manual_monitoring",label:"Surveillance manuelle continue"},{id:"warning_signs",label:"Signalisation de sécurité"},{id:"restricted_access",label:"Accès restreint à la zone"},{id:"backup_system",label:"Système de secours activé"},{id:"fire_watch",label:"Ronde incendie"},{id:"emergency_plan",label:"Plan d'urgence communiqué"}];function La({form:t,autoCalculatedCriticite:r,autoCalculatedDureeType:u}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{control:t.control,name:"bypassType",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Type de bypass"}),e.jsxs(k,{onValueChange:l.onChange,value:l.value,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner le type"})})}),e.jsx(T,{children:Object.entries(Es).map(([d,x])=>e.jsx(a,{value:d,children:x},d))})]}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Criticité:"}),e.jsx(P,{variant:r==="securite"?"destructive":"secondary",children:Vs[r]||r})]}),u&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Durée:"}),e.jsx(P,{variant:"outline",children:zs[u]||u})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(V,{control:t.control,name:"reason",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Raison du bypass"}),e.jsxs(k,{onValueChange:l.onChange,value:l.value,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner la raison"})})}),e.jsx(T,{children:Ia.map(d=>e.jsx(a,{value:d.value,children:d.label},d.value))})]}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"urgencyLevel",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Niveau d'urgence"}),e.jsxs(k,{onValueChange:l.onChange,value:l.value,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner l'urgence"})})}),e.jsx(T,{children:_a.map(d=>e.jsx(a,{value:d.value,children:d.label},d.value))})]}),e.jsx(Y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(V,{control:t.control,name:"plannedStartDate",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Date de début prévue"}),e.jsx(B,{children:e.jsx(je,{type:"datetime-local",...l})}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"estimatedDuration",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Durée estimée (heures)"}),e.jsx(B,{children:e.jsx(je,{type:"number",min:1,max:168,...l})}),e.jsx(Y,{})]})})]}),e.jsx(V,{control:t.control,name:"detailedJustification",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Justification détaillée"}),e.jsx(B,{children:e.jsx(be,{rows:3,placeholder:"Décrivez en détail la raison du bypass...",...l})}),e.jsx(Y,{})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["safetyImpact","operationalImpact","environmentalImpact"].map(l=>e.jsx(V,{control:t.control,name:l,render:({field:d})=>e.jsxs(z,{children:[e.jsx(E,{children:l==="safetyImpact"?"Impact sécurité":l==="operationalImpact"?"Impact opérationnel":"Impact environnemental"}),e.jsxs(k,{onValueChange:d.onChange,value:d.value,children:[e.jsx(B,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Sélectionner"})})}),e.jsx(T,{children:ka.map(x=>e.jsx(a,{value:x.value,children:x.label},x.value))})]}),e.jsx(Y,{})]})},l))}),e.jsx(V,{control:t.control,name:"mitigationMeasures",render:()=>e.jsxs(z,{children:[e.jsx(E,{children:"Mesures d'atténuation"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:Da.map(l=>e.jsx(V,{control:t.control,name:"mitigationMeasures",render:({field:d})=>e.jsxs(z,{className:"flex items-center space-x-2 space-y-0",children:[e.jsx(B,{children:e.jsx(ls,{checked:(d.value||[]).includes(l.id),onCheckedChange:x=>{const n=d.value||[];x?d.onChange([...n,l.id]):d.onChange(n.filter(m=>m!==l.id))}})}),e.jsx(E,{className:"text-sm font-normal cursor-pointer",children:l.label})]})},l.id))}),e.jsx(Y,{})]})}),e.jsx(V,{control:t.control,name:"contingencyPlan",render:({field:l})=>e.jsxs(z,{children:[e.jsx(E,{children:"Plan de contingence (optionnel)"}),e.jsx(B,{children:e.jsx(be,{rows:2,placeholder:"Décrivez le plan de contingence...",...l})}),e.jsx(Y,{})]})})]})}function Ta({form:t}){const[r,u]=h.useState(""),l=t.watch("oraMesuresCompensatoires")||[],d=()=>{r.trim()&&(t.setValue("oraMesuresCompensatoires",[...l,r.trim()]),u(""))},x=n=>{t.setValue("oraMesuresCompensatoires",l.filter((m,v)=>v!==n))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border border-destructive/50 bg-destructive/5 p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(P,{variant:"destructive",children:"ORA Requise"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cet équipement est classé comme système de sécurité (SIL). Une Operational Risk Assessment (ORA) est obligatoire avant approbation."})]}),e.jsx(V,{control:t.control,name:"oraDangersIdentifies",render:({field:n})=>e.jsxs(z,{children:[e.jsx(E,{children:"Dangers identifiés"}),e.jsx(B,{children:e.jsx(be,{rows:4,placeholder:"Décrivez les dangers identifiés suite à la mise en bypass de ce système de sécurité...",...n})}),e.jsx(Y,{})]})}),e.jsxs("div",{children:[e.jsx(E,{children:"Mesures compensatoires"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(je,{value:r,onChange:n=>u(n.target.value),placeholder:"Ajouter une mesure compensatoire",onKeyDown:n=>{n.key==="Enter"&&(n.preventDefault(),d())}}),e.jsx(M,{type:"button",size:"icon",onClick:d,children:e.jsx(xa,{className:"h-4 w-4"})})]}),l.length>0&&e.jsx("ul",{className:"mt-3 space-y-2",children:l.map((n,m)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm bg-muted p-2 rounded",children:[e.jsx("span",{className:"flex-1",children:n}),e.jsx(M,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>x(m),children:e.jsx(Qs,{className:"h-3 w-3"})})]},m))}),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Au moins une mesure compensatoire est requise."})]}),e.jsx(V,{control:t.control,name:"oraIplAffectees",render:({field:n})=>e.jsxs(z,{children:[e.jsx(E,{children:"IPL affectées (optionnel)"}),e.jsx(B,{children:e.jsx(be,{rows:2,placeholder:"Listez les Independent Protection Layers affectées...",...n})}),e.jsx(Y,{})]})})]})}const Pa={preventive_maintenance:"Maintenance préventive",corrective_maintenance:"Maintenance corrective",calibration:"Étalonnage capteur",testing:"Test de fonctionnement",emergency_repair:"Réparation urgente",system_upgrade:"Mise à niveau système",investigation:"Investigation",other:"Autre"},ts={very_low:"Très faible",low:"Faible",medium:"Moyen",high:"Élevé",very_high:"Très élevé"};function Ma({form:t,equipmentName:r,sensorName:u,siteName:l,zoneName:d,showOra:x}){var m,v;const n=t.getValues();return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(p,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-base",children:"Équipement & Localisation"})}),e.jsxs(f,{className:"text-sm space-y-1",children:[l&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Site:"})," ",l]}),d&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Zone:"})," ",d]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Équipement:"})," ",r||n.equipmentId]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Capteur:"})," ",u||n.sensorId]})]})]}),e.jsxs(p,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-base",children:"Détails du bypass"})}),e.jsxs(f,{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.bypassType&&e.jsx(P,{variant:"outline",children:Es[n.bypassType]||n.bypassType}),n.criticite&&e.jsx(P,{variant:n.criticite==="securite"?"destructive":"secondary",children:Vs[n.criticite]||n.criticite}),n.dureeType&&e.jsx(P,{variant:"outline",children:zs[n.dureeType]||n.dureeType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Raison:"})," ",Pa[n.reason]||n.reason]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Urgence:"})," ",n.urgencyLevel]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Début:"})," ",n.plannedStartDate]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Durée:"})," ",n.estimatedDuration,"h"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Justification:"})," ",n.detailedJustification]})]})]}),e.jsxs(p,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-base",children:"Impacts & Mesures"})}),e.jsxs(f,{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Sécurité:"})," ",ts[n.safetyImpact]||n.safetyImpact]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Opérationnel:"})," ",ts[n.operationalImpact]||n.operationalImpact]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Environnemental:"})," ",ts[n.environmentalImpact]||n.environmentalImpact]}),((m=n.mitigationMeasures)==null?void 0:m.length)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Mesures d'atténuation:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:n.mitigationMeasures.map((o,y)=>e.jsx("li",{children:o},y))})]}),n.contingencyPlan&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan de contingence:"})," ",n.contingencyPlan]})]})]}),x&&n.oraDangersIdentifies&&e.jsxs(p,{children:[e.jsx(I,{className:"pb-2",children:e.jsxs(F,{className:"text-base flex items-center gap-2",children:["ORA ",e.jsx(P,{variant:"destructive",children:"Sécurité"})]})}),e.jsxs(f,{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Dangers:"})," ",n.oraDangersIdentifies]}),((v=n.oraMesuresCompensatoires)==null?void 0:v.length)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Mesures compensatoires:"}),e.jsx("ul",{className:"list-disc list-inside mt-1",children:n.oraMesuresCompensatoires.map((o,y)=>e.jsx("li",{children:o},y))})]}),n.oraIplAffectees&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"IPL affectées:"})," ",n.oraIplAffectees]})]})]}),e.jsxs(p,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-base",children:"Engagements de sécurité"})}),e.jsxs(f,{className:"space-y-3",children:[e.jsx(V,{control:t.control,name:"safetyAck1",render:({field:o})=>e.jsxs(z,{className:"flex items-start space-x-2 space-y-0",children:[e.jsx(B,{children:e.jsx(ls,{checked:o.value,onCheckedChange:o.onChange})}),e.jsx(E,{className:"text-sm font-normal",children:"Je confirme que les mesures de sécurité compensatoires sont en place"})]})}),e.jsx(V,{control:t.control,name:"safetyAck2",render:({field:o})=>e.jsxs(z,{className:"flex items-start space-x-2 space-y-0",children:[e.jsx(B,{children:e.jsx(ls,{checked:o.value,onCheckedChange:o.onChange})}),e.jsx(E,{className:"text-sm font-normal",children:"Je m'engage à restaurer le bypass dès la fin des travaux"})]})})]})]})]})}const Fa=ca({siteId:W().min(1,"Veuillez sélectionner un site"),zoneId:W().min(1,"Veuillez sélectionner une zone"),equipmentId:W().min(1,"Veuillez sélectionner un équipement"),sensorId:W().min(1,"Veuillez sélectionner un capteur"),bypassType:ye(["maintenance","operationnel","permissif"]),reason:ye(["preventive_maintenance","corrective_maintenance","calibration","testing","emergency_repair","system_upgrade","investigation","other"]),urgencyLevel:ye(["low","normal","high","critical","emergency"]),plannedStartDate:W().min(1,"Date de début requise"),estimatedDuration:W().min(1,"Durée requise"),detailedJustification:W().min(20,"Justification minimale: 20 caractères"),safetyImpact:ye(["very_low","low","medium","high","very_high"]),operationalImpact:ye(["very_low","low","medium","high","very_high"]),environmentalImpact:ye(["very_low","low","medium","high","very_high"]),mitigationMeasures:gs(W()).min(1,"Au moins une mesure d'atténuation requise"),contingencyPlan:W().optional(),oraDangersIdentifies:W().optional(),oraMesuresCompensatoires:gs(W()).optional(),oraIplAffectees:W().optional(),safetyAck1:vs().refine(t=>t===!0,"Requis"),safetyAck2:vs().refine(t=>t===!0,"Requis"),criticite:W().optional(),dureeType:W().optional()}),Ra=()=>{const t=Ns();ys();const[r,u]=h.useState(1),[l,d]=h.useState(!1),[x,n]=h.useState(null),m=da({resolver:ma(Fa),defaultValues:{siteId:"",zoneId:"",equipmentId:"",sensorId:"",bypassType:void 0,reason:void 0,urgencyLevel:void 0,plannedStartDate:"",estimatedDuration:"",detailedJustification:"",safetyImpact:void 0,operationalImpact:void 0,environmentalImpact:void 0,mitigationMeasures:[],contingencyPlan:"",oraDangersIdentifies:"",oraMesuresCompensatoires:[],oraIplAffectees:"",safetyAck1:!1,safetyAck2:!1,criticite:"",dureeType:""}}),v=m.watch("equipmentId"),o=m.watch("estimatedDuration");h.useEffect(()=>{v&&se.get(`/equipment/${v}`).then(w=>{const H=w.data.data||w.data;n(H);const te=H.is_security_equipment?"securite":"process";m.setValue("criticite",te)}).catch(console.error)},[v]),h.useEffect(()=>{const w=parseInt(String(o));!isNaN(w)&&w>0&&m.setValue("dureeType",w<48?"court_terme":"long_terme")},[o]);const y=m.watch("criticite"),A=m.watch("dureeType"),R=y==="securite",K=h.useMemo(()=>{const w=[{id:1,title:"Équipement"},{id:2,title:"Détails"}];return R?(w.push({id:3,title:"ORA"}),w.push({id:4,title:"Récapitulatif"})):w.push({id:3,title:"Récapitulatif"}),w},[R]),U=K.length,q=R?4:3,ae=async()=>{let w=[];if(r===1)w=["siteId","zoneId","equipmentId","sensorId"];else if(r===2)w=["bypassType","reason","urgencyLevel","plannedStartDate","estimatedDuration","detailedJustification","safetyImpact","operationalImpact","environmentalImpact","mitigationMeasures"];else if(r===3&&R){const H=m.getValues("oraDangersIdentifies"),te=m.getValues("oraMesuresCompensatoires");return!H||H.trim().length===0?(m.setError("oraDangersIdentifies",{message:"Les dangers doivent être identifiés"}),!1):!te||te.length===0?(ke.error("Au moins une mesure compensatoire est requise"),!1):!0}return w.length>0?await m.trigger(w):!0},j=async()=>{await ae()&&u(H=>Math.min(H+1,U))},N=()=>{u(w=>Math.max(w-1,1))},ie=async w=>{var H,te,De;if(!(!w&&!await m.trigger(["safetyAck1","safetyAck2"]))){d(!0);try{const _=m.getValues(),Ce={reason:_.reason,detailedJustification:_.detailedJustification,urgencyLevel:_.urgencyLevel,equipmentId:parseInt(_.equipmentId),sensorId:parseInt(_.sensorId),plannedStartDate:_.plannedStartDate,estimatedDuration:parseInt(_.estimatedDuration),safetyImpact:_.safetyImpact,operationalImpact:_.operationalImpact,environmentalImpact:_.environmentalImpact,mitigationMeasures:_.mitigationMeasures,contingencyPlan:_.contingencyPlan||void 0,bypassType:_.bypassType,isDraft:w},pe=await se.post("/requests",Ce);if(R&&_.oraDangersIdentifies&&!w){const S=((H=pe.data.data)==null?void 0:H.id)||pe.data.id;await se.post(`/requests/${S}/ora`,{dangers_identifies:_.oraDangersIdentifies,mesures_compensatoires:_.oraMesuresCompensatoires,ipl_affectees:_.oraIplAffectees||void 0})}ke.success(w?"Brouillon sauvegardé":"Demande de bypass soumise avec succès"),t("/requests")}catch(_){const Ce=((De=(te=_.response)==null?void 0:te.data)==null?void 0:De.message)||"Erreur lors de la soumission";ke.error(Ce)}finally{d(!1)}}};return e.jsxs(p,{children:[e.jsx(I,{children:e.jsx(F,{children:"Nouvelle demande de bypass"})}),e.jsxs(f,{children:[e.jsx(ba,{steps:K,currentStep:r,onStepClick:w=>{w<r&&u(w)}}),e.jsx(oa,{...m,children:e.jsxs("form",{onSubmit:w=>w.preventDefault(),className:"space-y-6",children:[r===1&&e.jsx(Aa,{form:m}),r===2&&e.jsx(La,{form:m,autoCalculatedCriticite:y,autoCalculatedDureeType:A}),r===3&&R&&e.jsx(Ta,{form:m}),r===q&&e.jsx(Ma,{form:m,equipmentName:x==null?void 0:x.name,sensorName:void 0,showOra:R}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(M,{type:"button",variant:"outline",onClick:N,disabled:r===1,children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Précédent"]}),e.jsxs("div",{className:"flex gap-2",children:[r===q&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{type:"button",variant:"outline",onClick:()=>ie(!0),disabled:l,children:[l?e.jsx(js,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(ha,{className:"mr-2 h-4 w-4"}),"Sauvegarder brouillon"]}),e.jsxs(M,{type:"button",onClick:()=>ie(!1),disabled:l,children:[l?e.jsx(js,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(fa,{className:"mr-2 h-4 w-4"}),"Soumettre"]})]}),r<U&&e.jsxs(M,{type:"button",onClick:j,children:["Suivant",e.jsx(pa,{className:"ml-2 h-4 w-4"})]})]})]})]})})]})]})};function he({request:t}){const[r,u]=h.useState(!1);h.useState({validation_status:"approved",rejection_reason:""});const l=Ns(),[d,x]=h.useState(!1),[n,m]=h.useState(!1),[v,o]=h.useState(""),y=j=>{switch(j){case"Haute":return"bg-destructive text-destructive-foreground";case"high":return"bg-destructive text-destructive-foreground";case"Moyenne":return"bg-warning text-warning-foreground";case"medium":return"bg-warning text-warning-foreground";case"Faible":return"bg-success text-success-foreground";case"low":return"bg-success text-success-foreground";default:return"bg-muted text-muted-foreground"}},A={preventive_maintenance:"Maintenance préventive",corrective_maintenance:"Maintenance corrective",calibration:"Étalonnage",testing:"Tests",emergency_repair:"Réparation d'urgence",system_upgrade:"Mise à niveau système",investigation:"Investigation",other:"Autre"};function R(j){return A[j]??j}const K=(j,N)=>{try{se({method:"put",url:`/requests/${j}/validate`,data:N}).then(ie=>{ie?(ke.success("Demande de Bypass Soumis avec Succes"),l("/requests/mine")):ke.error("Probleme de connexion")}),x(!d),m(!n),u(!r)}catch(ie){console.error("Erreur lors de la soumission:",ie)}},U=j=>{switch(j){case"En attente":return"bg-warning text-warning-foreground";case"pending":return"bg-warning text-warning-foreground";case"Approuvé":return"bg-success text-success-foreground";case"approved":return"bg-success text-success-foreground";case"En cours":return"bg-primary text-primary-foreground";case"in_progress":return"bg-primary text-primary-foreground";default:return"bg-muted text-muted-foreground"}},q=j=>{switch(j){case"En attente":return e.jsx(rs,{className:"w-4 h-4"});case"pending":return e.jsx(rs,{className:"w-4 h-4"});case"Approuvé":return e.jsx(de,{className:"w-4 h-4"});case"approved":return e.jsx(de,{className:"w-4 h-4"});case"En cours":return e.jsx(Ue,{className:"w-4 h-4"});case"in_progress":return e.jsx(Ue,{className:"w-4 h-4"});case"Rejeté":return e.jsx(is,{className:"w-4 h-4"});case"rejected":return e.jsx(is,{className:"w-4 h-4"});default:return e.jsx(Z,{className:"w-4 h-4"})}},ae=(j,N)=>{const ie=new Date(j),w=new Date(N);return(ie.getTime()-w.getTime())/(1e3*60*60)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{open:r,onOpenChange:u,children:[e.jsx(qs,{asChild:!0,children:e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(ea,{className:"w-4 h-4 mr-2"}),"Voir"]})}),e.jsxs(Xe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Qe,{children:[e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Détails de la demande ",t.request_code]}),e.jsx(es,{children:"Informations complètes de la demande de bypass"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(I,{children:e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Statut et priorité"]})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[q(t.status),e.jsx(P,{className:U(t.status),children:t.status})]}),e.jsxs(P,{variant:"outline",className:y(t.priority),children:["Priorité ",t.priority]})]})})]}),e.jsxs(p,{children:[e.jsx(I,{children:e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Informations générales"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(sa,{className:"w-4 h-4"}),"Demandeur"]}),e.jsx("p",{className:"font-medium",children:t.requester?t.requester.full_name:"Moi"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Date de demande"]}),e.jsx("p",{className:"font-medium",children:new Date(t.created_at).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsx(ps,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ga,{className:"w-4 h-4"}),"Raison du bypass"]}),e.jsx("p",{className:"font-medium",children:R(t.title)})]})]})]}),e.jsxs(p,{children:[e.jsx(I,{children:e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(ua,{className:"w-5 h-5"}),"Équipement et capteur"]})}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Équipement"}),e.jsx("p",{className:"font-medium",children:t.equipment.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Capteur concerné"}),e.jsx("p",{className:"font-medium",children:t.sensor.name})]})]})})]}),e.jsxs(p,{children:[e.jsx(I,{children:e.jsx(F,{className:"text-lg",children:"Détails supplémentaires"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Durée estimée"}),e.jsxs("p",{className:"font-medium",children:[ae(t.end_time,t.start_time)," heures"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Zone"}),e.jsx("p",{className:"font-medium",children:t.equipment.zone.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Date de début prévue"}),e.jsx("p",{className:"font-medium",children:new Date(t.start_time).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Date de fin prévue"}),e.jsx("p",{className:"font-medium",children:new Date(t.end_time).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsx(ps,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Justification détaillée"}),e.jsx("p",{className:"text-sm bg-muted/50 p-3 rounded",children:t.description})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4",children:[e.jsx(M,{variant:"outline",onClick:()=>u(!1),children:"Fermer"}),t.status==="pending"&&(t.requester.role==="administrator"||t.requester.role==="supervisor")&&e.jsxs(e.Fragment,{children:[e.jsx(M,{variant:"destructive",onClick:()=>{x(!d)},children:"Rejeter"}),e.jsx(M,{onClick:()=>{m(!n)},children:"Approuver"})]})]})]})]})]}),e.jsx(Ke,{open:d,onOpenChange:x,children:e.jsxs(Xe,{children:[e.jsxs(Qe,{children:[e.jsx(qe,{children:"Raison du rejet"}),e.jsx(es,{children:"Merci de saisir une justification avant de rejeter la demande."})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(be,{placeholder:"Expliquez la raison du rejet... Ecrire (RAS) au cas contraire",value:v,onChange:j=>o(j.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(M,{variant:"outline",onClick:()=>x(!1),children:"Annuler"}),e.jsx(M,{variant:"destructive",onClick:()=>{K(t.id,{validation_status:"rejected",rejection_reason:v}),x(!1),u(!1)},disabled:!v.trim(),children:"Confirmer le rejet"})]})]})}),e.jsx(Ke,{open:n,onOpenChange:m,children:e.jsxs(Xe,{children:[e.jsxs(Qe,{children:[e.jsx(qe,{children:"Raison de la validation"}),e.jsx(es,{children:"Merci de saisir une justification avant d'Accepter la demande."})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(be,{placeholder:"Expliquez la raison du rejet... Ecrire (RAS) au cas contraire",value:v,onChange:j=>o(j.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(M,{variant:"outline",onClick:()=>x(!1),children:"Annuler"}),e.jsx(M,{variant:"destructive",onClick:()=>{K(t.id,{validation_status:"approved",rejection_reason:v}),x(!1),u(!1)},disabled:!v.trim(),children:"Confirmer la validation"})]})]})})]})}function rt(){const t=aa(),[r,u]=h.useState(""),[l,d]=h.useState("all"),[x,n]=h.useState("all"),[m,v]=h.useState("all"),[o,y]=h.useState(void 0),[A,R]=h.useState([]),[K,U]=h.useState([]),[q,ae]=h.useState([]),[j,N]=h.useState([]),[ie,w]=h.useState(!1),[H,te]=h.useState(!0),[De,_]=h.useState(!1),[Ce,pe]=h.useState(!1),{user:S}=ys(),[C,X]=h.useState(1),[J,Le]=h.useState(3),[O,Bs]=h.useState(((S==null?void 0:S.role)!=="user","mine")),Te=()=>{switch(O){case"all":return ie;case"mine":return H;case"pending":return De;case"active":return Ce;default:return H}},Os=t.pathname==="/requests/new",$s=s=>{const c=new Date,g=new Date(c.getFullYear(),c.getMonth(),c.getDate());switch(s){case"today":return{start:g,end:new Date(g.getTime()+24*60*60*1e3-1)};case"week":const b=new Date(g),re=g.getDay(),Q=re===0?6:re-1;b.setDate(g.getDate()-Q),b.setHours(0,0,0,0);const G=new Date(b);return G.setDate(b.getDate()+6),G.setHours(23,59,59,999),{start:b,end:G};case"month":const xs=new Date(c.getFullYear(),c.getMonth(),1);xs.setHours(0,0,0,0);const Hs=new Date(c.getFullYear(),c.getMonth()+1,0,23,59,59,999);return{start:xs,end:Hs};case"custom":if(o){const hs=new Date(o);hs.setHours(0,0,0,0);const us=new Date(o);return us.setHours(23,59,59,999),{start:hs,end:us}}return null;default:return null}},Pe=s=>{if(m==="all")return!0;const c=$s(m);if(c&&s.created_at){const g=new Date(s.created_at);return g>=c.start&&g<=c.end}else if(m==="custom"&&!o)return!0;return!1},fe=(A??[]).filter(s=>{var Q,G;const c=(((Q=s.equipment)==null?void 0:Q.name)||"").toLowerCase().includes(r.toLowerCase())||(((G=s.sensor)==null?void 0:G.name)||"").toLowerCase().includes(r.toLowerCase())||(s.request_code||"").toLowerCase().includes(r.toLowerCase()),g=l==="all"||s.status===l,b=x==="all"||s.priority===x,re=Pe(s);return c&&g&&b&&re}),me=(K??[]).filter(s=>{var Q,G;const c=(((Q=s.equipment)==null?void 0:Q.name)||"").toLowerCase().includes(r.toLowerCase())||(((G=s.sensor)==null?void 0:G.name)||"").toLowerCase().includes(r.toLowerCase())||(s.request_code||"").toLowerCase().includes(r.toLowerCase()),g=l==="all"||s.status===l,b=x==="all"||s.priority===x,re=Pe(s);return c&&g&&b&&re}),ge=(q??[]).filter(s=>{var Q,G;const c=(((Q=s.equipment)==null?void 0:Q.name)||"").toLowerCase().includes(r.toLowerCase())||(((G=s.sensor)==null?void 0:G.name)||"").toLowerCase().includes(r.toLowerCase())||(s.request_code||"").toLowerCase().includes(r.toLowerCase()),g=l==="all"||s.status===l,b=x==="all"||s.priority===x,re=Pe(s);return c&&g&&b&&re}),ve=(j??[]).filter(s=>{var Q,G;const c=(((Q=s.equipment)==null?void 0:Q.name)||"").toLowerCase().includes(r.toLowerCase())||(((G=s.sensor)==null?void 0:G.name)||"").toLowerCase().includes(r.toLowerCase())||(s.request_code||"").toLowerCase().includes(r.toLowerCase()),g=l==="all"||s.status===l,b=x==="all"||s.priority===x,re=Pe(s);return c&&g&&b&&re}),os=(()=>{switch(O){case"all":return fe;case"mine":return me;case"pending":return ge;case"active":return ve;default:return me}})(),$=Math.ceil(os.length/J),we=(C-1)*J,Se=we+J,le=os.slice(we,Se);h.useEffect(()=>{X(1)},[r,l,x,m,o,O,J]),h.useEffect(()=>{m!=="custom"&&y(void 0)},[m]),h.useEffect(()=>{S&&["administrateur","administrator"].includes(S.role)&&(w(!0),se.get("/requests").then(s=>{Array.isArray(s.data)?R(s.data):s.data&&s.data.data&&Array.isArray(s.data.data)?R(s.data.data):R([]),w(!1)}).catch(s=>{console.error("Error fetching data:",s),w(!1)})),S&&["administrateur","administrator","chef_de_quart","supervisor","responsable_hse","resp_exploitation","directeur","director"].includes(S.role)&&(_(!0),se.get("/requests/pending").then(s=>{Array.isArray(s.data)?ae(s.data):s.data&&s.data.data&&Array.isArray(s.data.data)?ae(s.data.data):ae([]),_(!1)}).catch(s=>{console.error("Error fetching data:",s),_(!1)}),pe(!0),se.get("/requests/active").then(s=>{Array.isArray(s.data)?N(s.data):s.data&&s.data.data&&Array.isArray(s.data.data)?N(s.data.data):N([]),pe(!1)}).catch(s=>{console.error("Error fetching data:",s),pe(!1)})),te(!0),se.get("/requests/mine").then(s=>{Array.isArray(s.data)?U(s.data):s.data&&s.data.data&&Array.isArray(s.data.data)?U(s.data.data):U([]),te(!1)}).catch(s=>{console.error("Error fetching data:",s),U([]),te(!1)})},[t.key]);const oe=s=>{switch(s){case"Haute":return"bg-destructive text-destructive-foreground";case"high":return"bg-destructive text-destructive-foreground";case"Moyenne":return"bg-warning text-warning-foreground";case"medium":return"bg-warning text-warning-foreground";case"Faible":return"bg-success text-success-foreground";case"low":return"bg-success text-success-foreground";default:return"bg-muted text-muted-foreground"}},xe=s=>{switch(s){case"draft":return"bg-muted text-muted-foreground";case"pending":return"bg-warning text-warning-foreground";case"approved":return"bg-blue-500 text-white";case"active":return"bg-green-600 text-white";case"closed":return"bg-gray-600 text-white";case"expired":return"bg-orange-500 text-white";case"rejected":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}},ne=s=>{switch(s){case"draft":return e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"pending":return e.jsx(rs,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"approved":return e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"active":return e.jsx(ja,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"closed":return e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"expired":return e.jsx(Ue,{className:"w-5 h-5 sm:w-6 sm:h-6"});case"rejected":return e.jsx(is,{className:"w-5 h-5 sm:w-6 sm:h-6"});default:return e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"})}},Me=()=>{u(""),d("all"),n("all"),v("all"),y(void 0)};return Os?e.jsxs("div",{className:"flex-1 space-y-3 sm:space-y-4 md:space-y-6 p-3 sm:p-4 md:p-6",children:[e.jsx("div",{className:"w-full max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-left w-full sm:w-auto",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold tracking-tight",children:"Nouvelle demande de bypass"}),e.jsx("p",{className:"text-xs sm:text-sm md:text-base text-muted-foreground mt-1",children:"Créer une nouvelle demande de bypass de capteur"})]}),e.jsx(M,{variant:"outline",size:"icon",asChild:!0,className:"flex-shrink-0 rounded-full w-12 h-12",children:e.jsx(ss,{to:"/requests",children:e.jsx(ns,{className:"w-5 h-5"})})})]})}),e.jsx(Ra,{})]}):e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx(p,{className:"bg-card rounded-lg border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx(Z,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words mb-1",children:"Gestion des demandes"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words mb-2",children:"Suivi et gestion des demandes de bypass"}),e.jsx(ta,{children:e.jsxs(la,{children:[e.jsx(fs,{children:e.jsx(na,{asChild:!0,children:e.jsx(ss,{to:"/",children:"Tableau de bord"})})}),e.jsx(ia,{}),e.jsx(fs,{children:e.jsx(ra,{children:"Demandes"})})]})})]})]}),e.jsx(M,{variant:"outline",size:"icon",className:"flex-shrink-0 rounded-full w-10 h-10",asChild:!0,children:e.jsx(ss,{to:"/",children:e.jsx(ns,{className:"w-4 h-4"})})})]})})}),e.jsxs(ya,{value:O,onValueChange:Bs,className:"w-full min-w-0",children:[e.jsxs(Rs,{className:"flex flex-row w-full h-auto gap-2 flex-wrap justify-between",children:[(S==null?void 0:S.role)==="administrator"&&e.jsx(Ie,{value:"all",onClick:Me,className:"text-xs sm:text-sm py-2 px-2 sm:px-4 truncate flex-1 min-w-0",children:"Toutes les demandes"}),e.jsx(Ie,{value:"mine",onClick:Me,className:"text-xs sm:text-sm py-2 px-2 sm:px-4 truncate flex-1 min-w-0",children:"Mes demandes"}),((S==null?void 0:S.role)==="administrator"||(S==null?void 0:S.role)==="supervisor")&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{value:"pending",onClick:Me,className:"text-xs sm:text-sm py-2 px-2 sm:px-4 truncate flex-1 min-w-0",children:e.jsx("span",{className:"truncate",children:"En attente"})}),e.jsx(Ie,{value:"active",onClick:Me,className:"text-xs sm:text-sm py-2 px-2 sm:px-4 truncate flex-1 min-w-0",children:"Bypass actifs"})]})]}),(S==null?void 0:S.role)==="administrator"&&e.jsxs(_e,{value:"all",className:"space-y-4 sm:space-y-6",children:[e.jsx(p,{className:"w-full box-border",children:e.jsxs(f,{className:"p-4 sm:p-6 w-full min-w-0",children:[e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 w-full min-w-0",children:[e.jsxs("div",{className:"relative sm:col-span-2 lg:col-span-1 w-full min-w-0",children:[e.jsx(Fe,{className:"absolute left-2 top-2.5 h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:r,onChange:s=>u(s.target.value),className:"pl-8 sm:pl-10 w-full text-sm"})]}),e.jsxs(k,{value:l,onValueChange:d,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Statut"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Tous les statuts"}),e.jsx(a,{value:"draft",children:"Brouillon"}),e.jsx(a,{value:"pending",children:"En attente"}),e.jsx(a,{value:"approved",children:"Approuvé"}),e.jsx(a,{value:"active",children:"Actif"}),e.jsx(a,{value:"closed",children:"Clôturé"}),e.jsx(a,{value:"expired",children:"Expiré"}),e.jsx(a,{value:"rejected",children:"Rejeté"})]})]}),e.jsxs(k,{value:x,onValueChange:n,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Priorité"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les priorités"}),e.jsx(a,{value:"high",children:"Haute"}),e.jsx(a,{value:"medium",children:"Moyenne"}),e.jsx(a,{value:"low",children:"Faible"})]})]}),e.jsxs(k,{value:m,onValueChange:v,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Période"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les périodes"}),e.jsx(a,{value:"today",children:"Aujourd'hui"}),e.jsx(a,{value:"week",children:"Cette semaine"}),e.jsx(a,{value:"month",children:"Ce mois"}),e.jsx(a,{value:"custom",children:"Personnalisée"})]})]}),e.jsxs(M,{variant:"outline",onClick:()=>{u(""),d("all"),n("all"),v("all"),y(void 0)},className:"text-sm w-full sm:w-auto min-w-0 truncate",children:[e.jsx("span",{className:"hidden sm:inline truncate",children:"Réinitialiser filtres"}),e.jsx("span",{className:"sm:hidden truncate",children:"Réinitialiser"})]})]}),m==="custom"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[e.jsx(ce,{className:"text-sm",children:"Sélectionner une date"}),e.jsxs(Oe,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:`w-full justify-start text-left font-normal text-sm ${!o&&"text-muted-foreground"}`,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),o?He(o,"PPP",{locale:Ye}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Je,{className:"w-auto p-0",align:"start",children:e.jsx(Ge,{mode:"single",selected:o,onSelect:y,initialFocus:!0})})]})]})})]})}),fe.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full min-w-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 min-w-0 flex-wrap",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ce,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap flex-shrink-0",children:"Éléments par page:"}),e.jsxs(k,{value:J.toString(),onValueChange:s=>Le(Number(s)),children:[e.jsx(D,{className:"w-16 sm:w-20 flex-shrink-0 h-8 text-xs sm:text-sm",children:e.jsx(L,{})}),e.jsxs(T,{children:[e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"12",children:"12"}),e.jsx(a,{value:"15",children:"15"})]})]})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-left",children:["Affichage de ",we+1," à ",Math.min(Se,fe.length)," sur ",fe.length," demande",fe.length>1?"s":""]})]}),Te()?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx(i,{className:"w-6 h-6 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-5 w-32 mb-2"}),e.jsx(i,{className:"h-4 w-24"})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-28"})]}),e.jsx(i,{className:"h-3 w-full mt-2"}),e.jsx(i,{className:"h-8 w-24 mt-2"})]})]},c))}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"w-full min-w-0 box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(i,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-4 w-32 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]})}),e.jsxs(f,{className:"p-3 sm:p-4 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-36"})]})]}),e.jsx(i,{className:"h-3 w-full mt-3 pt-3"}),e.jsx(i,{className:"h-8 w-28 mt-3"})]})]},c))})]}):O==="all"&&le.length===0?e.jsx(p,{className:"w-full box-border",children:e.jsxs(f,{className:"text-center py-6 sm:py-8",children:[e.jsx(Z,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Aucune demande trouvée."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:O==="all"&&le.map(s=>{var c,g,b;return e.jsxs(p,{className:"hover:shadow-lg transition-shadow flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 flex-shrink-0",children:ne(s.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(F,{className:"text-lg truncate min-w-0",children:s.request_code}),e.jsxs(Ne,{className:"text-xs line-clamp-2 mt-1.5 min-w-0",children:[((c=s.equipment)==null?void 0:c.name)||"N/A"," - ",((g=s.sensor)==null?void 0:g.name)||"N/A"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Demandeur:"}),e.jsx("span",{className:"text-xs truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Date:"}),e.jsx("span",{className:"text-xs truncate whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})})]}),s.description&&e.jsx("div",{className:"pt-1",children:e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 min-w-0",children:s.description})}),e.jsx("div",{className:"pt-2",children:e.jsx(he,{request:s})})]})]},s.id)})}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:O==="all"&&le.map(s=>{var c,g,b;return e.jsx(p,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex-shrink-0",children:e.jsx("div",{className:"text-blue-600",children:s.status==="Approuvé"||s.status==="approved"?e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"}):ne(s.status)?e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center",children:ne(s.status)}):e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(F,{className:"text-base sm:text-lg font-bold truncate min-w-0",children:s.request_code}),e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((c=s.equipment)==null?void 0:c.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((g=s.sensor)==null?void 0:g.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 flex-1 min-w-0 items-center sm:items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-center truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center line-clamp-2 max-w-[300px]",children:s.description})]}),e.jsx("div",{className:"flex flex-col gap-2 sm:gap-3 flex-shrink-0 w-full sm:w-auto items-center sm:items-center",children:e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(he,{request:s})})})]})})},s.id)})})]}),fe.length>0&&$>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full min-w-0 overflow-x-hidden",children:e.jsx(Re,{children:e.jsxs(Ee,{className:"flex-wrap min-w-0",children:[e.jsx(ee,{children:e.jsx(Ve,{href:"#",onClick:s=>{s.preventDefault(),C>1&&X(C-1)},className:C===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:$},(s,c)=>c+1).map(s=>e.jsx(ee,{children:e.jsx(ze,{href:"#",onClick:c=>{c.preventDefault(),X(s)},isActive:C===s,className:"cursor-pointer",children:s})},s)),e.jsx(ee,{children:e.jsx(Be,{href:"#",onClick:s=>{s.preventDefault(),C<$&&X(C+1)},className:C===$?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]}),e.jsx(_e,{value:"mine",className:"space-y-4 sm:space-y-6",children:K.length===0?e.jsxs(p,{className:"w-full box-border",children:[e.jsxs(I,{className:"p-3 sm:p-4",children:[e.jsx(F,{className:"text-sm sm:text-base",children:"Mes demandes"}),e.jsx(Ne,{className:"text-xs sm:text-sm",children:"Vos demandes de bypass"})]}),e.jsx(f,{className:"p-3 sm:p-4 pt-0",children:e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground text-center py-6 sm:py-8",children:"Aucune demande."})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"w-full box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs(F,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(as,{className:"w-4 h-4 sm:w-4 sm:h-4"}),"Filtres"]})}),e.jsxs(f,{className:"p-3 sm:p-4 pt-0 w-full min-w-0",children:[e.jsxs("div",{className:"grid gap-3 sm:gap-3 md:gap-4 lg:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 w-full min-w-0",children:[e.jsxs("div",{className:"relative sm:col-span-2 lg:col-span-1 w-full min-w-0",children:[e.jsx(Fe,{className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 sm:w-4 sm:h-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:r,onChange:s=>u(s.target.value),className:"pl-8 sm:pl-10 text-sm w-full"})]}),e.jsxs(k,{value:l,onValueChange:d,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Statut"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Tous les statuts"}),e.jsx(a,{value:"draft",children:"Brouillon"}),e.jsx(a,{value:"pending",children:"En attente"}),e.jsx(a,{value:"approved",children:"Approuvé"}),e.jsx(a,{value:"active",children:"Actif"}),e.jsx(a,{value:"closed",children:"Clôturé"}),e.jsx(a,{value:"expired",children:"Expiré"}),e.jsx(a,{value:"rejected",children:"Rejeté"})]})]}),e.jsxs(k,{value:x,onValueChange:n,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Priorité"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les priorités"}),e.jsx(a,{value:"high",children:"Haute"}),e.jsx(a,{value:"medium",children:"Moyenne"}),e.jsx(a,{value:"low",children:"Faible"})]})]}),e.jsxs(k,{value:m,onValueChange:v,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Période"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les périodes"}),e.jsx(a,{value:"today",children:"Aujourd'hui"}),e.jsx(a,{value:"week",children:"Cette semaine"}),e.jsx(a,{value:"month",children:"Ce mois"}),e.jsx(a,{value:"custom",children:"Personnalisée"})]})]}),e.jsxs(M,{variant:"outline",onClick:()=>{u(""),d("all"),n("all"),v("all"),y(void 0)},className:"text-sm h-9 sm:h-10 w-full sm:w-auto",children:[e.jsx("span",{className:"hidden sm:inline",children:"Réinitialiser filtres"}),e.jsx("span",{className:"sm:hidden",children:"Réinitialiser"})]})]}),m==="custom"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[e.jsx(ce,{className:"text-sm",children:"Sélectionner une date"}),e.jsxs(Oe,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:`w-full justify-start text-left font-normal text-sm ${!o&&"text-muted-foreground"}`,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),o?He(o,"PPP",{locale:Ye}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Je,{className:"w-auto p-0",align:"start",children:e.jsx(Ge,{mode:"single",selected:o,onSelect:y,initialFocus:!0})})]})]})})]})]}),me.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full min-w-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 min-w-0 flex-wrap",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ce,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap flex-shrink-0",children:"Éléments par page:"}),e.jsxs(k,{value:J.toString(),onValueChange:s=>Le(Number(s)),children:[e.jsx(D,{className:"w-16 sm:w-20 flex-shrink-0 h-8 text-xs sm:text-sm",children:e.jsx(L,{})}),e.jsxs(T,{children:[e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"12",children:"12"}),e.jsx(a,{value:"15",children:"15"})]})]})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-left",children:["Affichage de ",we+1," à ",Math.min(Se,me.length)," sur ",me.length," demande",me.length>1?"s":""]})]}),Te()?e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-3 sm:space-y-4 w-full min-w-0",children:O==="mine"&&Array.from({length:J}).map((s,c)=>e.jsx(p,{className:"w-full min-w-0 box-border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[e.jsx(i,{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(i,{className:"h-5 sm:h-6 w-32"}),e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{className:"h-4 w-40"}),e.jsx(i,{className:"h-4 w-48"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 sm:gap-3 flex-shrink-0 w-full sm:w-auto",children:[e.jsx(i,{className:"h-4 w-32"}),e.jsx(i,{className:"h-3 w-28"}),e.jsx(i,{className:"h-3 w-48"}),e.jsx(i,{className:"h-8 w-20 mt-2"})]})]})})},c))})}):O==="mine"&&le.length===0?e.jsx(p,{className:"w-full box-border",children:e.jsxs(f,{className:"text-center py-6 sm:py-8",children:[e.jsx(Z,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Aucune demande trouvée."})]})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-3 sm:space-y-4 w-full min-w-0",children:O==="mine"&&le.map(s=>{var c,g;return e.jsx(p,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex-shrink-0",children:e.jsx("div",{className:"text-blue-600",children:s.status==="Approuvé"||s.status==="approved"?e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"}):ne(s.status)?e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center",children:ne(s.status)}):e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(F,{className:"text-base sm:text-lg font-bold truncate min-w-0",children:s.request_code}),e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((c=s.equipment)==null?void 0:c.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((g=s.sensor)==null?void 0:g.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 flex-1 min-w-0 items-center sm:items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-center truncate",children:s.requester?s.requester.full_name:"Moi"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center line-clamp-2 max-w-[300px]",children:s.description})]}),e.jsx("div",{className:"flex flex-col gap-2 sm:gap-3 flex-shrink-0 w-full sm:w-auto items-center sm:items-center",children:e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(he,{request:s})})})]})})},s.id)})})}),me.length>0&&$>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full min-w-0 overflow-x-hidden",children:e.jsx(Re,{children:e.jsxs(Ee,{className:"flex-wrap min-w-0",children:[e.jsx(ee,{children:e.jsx(Ve,{href:"#",onClick:s=>{s.preventDefault(),C>1&&X(C-1)},className:C===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:$},(s,c)=>c+1).map(s=>e.jsx(ee,{children:e.jsx(ze,{href:"#",onClick:c=>{c.preventDefault(),X(s)},isActive:C===s,className:"cursor-pointer",children:s})},s)),e.jsx(ee,{children:e.jsx(Be,{href:"#",onClick:s=>{s.preventDefault(),C<$&&X(C+1)},className:C===$?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})}),((S==null?void 0:S.role)==="administrator"||(S==null?void 0:S.role)==="supervisor")&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{value:"pending",className:"space-y-4 sm:space-y-6",children:q.length===0?e.jsxs(p,{className:"w-full box-border",children:[e.jsxs(I,{className:"p-3 sm:p-4",children:[e.jsx(F,{className:"text-sm sm:text-base",children:"En attente d'approbation"}),e.jsx(Ne,{className:"text-xs sm:text-sm",children:"Demandes nécessitant une action"})]}),e.jsx(f,{className:"p-3 sm:p-4 pt-0",children:e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground text-center py-6 sm:py-8",children:"Aucune demande en attente d'approbation."})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"w-full box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs(F,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(as,{className:"w-4 h-4 sm:w-4 sm:h-4"}),"Filtres"]})}),e.jsxs(f,{className:"p-3 sm:p-4 pt-0 w-full min-w-0",children:[e.jsxs("div",{className:"grid gap-3 sm:gap-3 md:gap-4 lg:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 w-full min-w-0",children:[e.jsxs("div",{className:"relative sm:col-span-2 lg:col-span-1 w-full min-w-0",children:[e.jsx(Fe,{className:"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 sm:w-4 sm:h-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:r,onChange:s=>u(s.target.value),className:"pl-8 sm:pl-10 text-sm w-full"})]}),e.jsxs(k,{value:l,onValueChange:d,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Statut"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Tous les statuts"}),e.jsx(a,{value:"draft",children:"Brouillon"}),e.jsx(a,{value:"pending",children:"En attente"}),e.jsx(a,{value:"approved",children:"Approuvé"}),e.jsx(a,{value:"active",children:"Actif"}),e.jsx(a,{value:"closed",children:"Clôturé"}),e.jsx(a,{value:"expired",children:"Expiré"}),e.jsx(a,{value:"rejected",children:"Rejeté"})]})]}),e.jsxs(k,{value:x,onValueChange:n,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Priorité"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les priorités"}),e.jsx(a,{value:"high",children:"Haute"}),e.jsx(a,{value:"medium",children:"Moyenne"}),e.jsx(a,{value:"low",children:"Faible"})]})]}),e.jsxs(k,{value:m,onValueChange:v,children:[e.jsx(D,{className:"text-sm h-9 sm:h-10 w-full min-w-0",children:e.jsx(L,{placeholder:"Période"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les périodes"}),e.jsx(a,{value:"today",children:"Aujourd'hui"}),e.jsx(a,{value:"week",children:"Cette semaine"}),e.jsx(a,{value:"month",children:"Ce mois"}),e.jsx(a,{value:"custom",children:"Personnalisée"})]})]}),e.jsxs(M,{variant:"outline",onClick:()=>{u(""),d("all"),n("all"),v("all"),y(void 0)},className:"text-sm h-9 sm:h-10 w-full sm:w-auto",children:[e.jsx("span",{className:"hidden sm:inline",children:"Réinitialiser filtres"}),e.jsx("span",{className:"sm:hidden",children:"Réinitialiser"})]})]}),m==="custom"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[e.jsx(ce,{className:"text-sm",children:"Sélectionner une date"}),e.jsxs(Oe,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:`w-full justify-start text-left font-normal text-sm ${!o&&"text-muted-foreground"}`,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),o?He(o,"PPP",{locale:Ye}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Je,{className:"w-auto p-0",align:"start",children:e.jsx(Ge,{mode:"single",selected:o,onSelect:y,initialFocus:!0})})]})]})})]})]}),ge.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full min-w-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 min-w-0 flex-wrap",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ce,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap flex-shrink-0",children:"Éléments par page:"}),e.jsxs(k,{value:J.toString(),onValueChange:s=>Le(Number(s)),children:[e.jsx(D,{className:"w-16 sm:w-20 flex-shrink-0 h-8 text-xs sm:text-sm",children:e.jsx(L,{})}),e.jsxs(T,{children:[e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"12",children:"12"}),e.jsx(a,{value:"15",children:"15"})]})]})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-left",children:["Affichage de ",we+1," à ",Math.min(Se,ge.length)," sur ",ge.length," demande",ge.length>1?"s":""]})]}),Te()?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx(i,{className:"w-6 h-6 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-5 w-32 mb-2"}),e.jsx(i,{className:"h-4 w-24"})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-28"})]}),e.jsx(i,{className:"h-3 w-full mt-2"}),e.jsx(i,{className:"h-8 w-24 mt-2"})]})]},c))}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"w-full min-w-0 box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(i,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-4 w-32 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]})}),e.jsxs(f,{className:"p-3 sm:p-4 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-36"})]})]}),e.jsx(i,{className:"h-3 w-full mt-3 pt-3"}),e.jsx(i,{className:"h-8 w-28 mt-3"})]})]},c))})]}):O==="pending"&&le.length===0?e.jsx(p,{className:"w-full box-border",children:e.jsxs(f,{className:"text-center py-6 sm:py-8",children:[e.jsx(Z,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Aucune demande trouvée."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:O==="pending"&&le.map(s=>{var c,g,b;return e.jsxs(p,{className:"hover:shadow-lg transition-shadow flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 flex-shrink-0",children:ne(s.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(F,{className:"text-lg truncate min-w-0",children:s.request_code}),e.jsxs(Ne,{className:"text-xs line-clamp-2 mt-1.5 min-w-0",children:[((c=s.equipment)==null?void 0:c.name)||"N/A"," - ",((g=s.sensor)==null?void 0:g.name)||"N/A"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Demandeur:"}),e.jsx("span",{className:"text-xs truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Date:"}),e.jsx("span",{className:"text-xs truncate whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})})]}),s.description&&e.jsx("div",{className:"pt-1",children:e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 min-w-0",children:s.description})}),e.jsx("div",{className:"pt-2",children:e.jsx(he,{request:s})})]})]},s.id)})}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:O==="pending"&&le.map(s=>{var c,g,b;return e.jsx(p,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex-shrink-0",children:e.jsx("div",{className:"text-blue-600",children:s.status==="Approuvé"||s.status==="approved"?e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"}):ne(s.status)?e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center",children:ne(s.status)}):e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(F,{className:"text-base sm:text-lg font-bold truncate min-w-0",children:s.request_code}),e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((c=s.equipment)==null?void 0:c.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((g=s.sensor)==null?void 0:g.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 flex-1 min-w-0 items-center sm:items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-center truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center line-clamp-2 max-w-[300px]",children:s.description})]}),e.jsx("div",{className:"flex flex-col gap-2 sm:gap-3 flex-shrink-0 w-full sm:w-auto items-center sm:items-center",children:e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(he,{request:s})})})]})})},s.id)})})]}),ge.length>0&&$>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full min-w-0 overflow-x-hidden",children:e.jsx(Re,{children:e.jsxs(Ee,{className:"flex-wrap min-w-0",children:[e.jsx(ee,{children:e.jsx(Ve,{href:"#",onClick:s=>{s.preventDefault(),C>1&&X(C-1)},className:C===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:$},(s,c)=>c+1).map(s=>e.jsx(ee,{children:e.jsx(ze,{href:"#",onClick:c=>{c.preventDefault(),X(s)},isActive:C===s,className:"cursor-pointer",children:s})},s)),e.jsx(ee,{children:e.jsx(Be,{href:"#",onClick:s=>{s.preventDefault(),C<$&&X(C+1)},className:C===$?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})}),e.jsx(_e,{value:"active",className:"space-y-4 sm:space-y-6",children:j.length===0?e.jsxs(p,{className:"w-full box-border",children:[e.jsxs(I,{className:"p-3 sm:p-4",children:[e.jsx(F,{className:"text-sm sm:text-base",children:"Bypass actifs"}),e.jsx(Ne,{className:"text-xs sm:text-sm",children:"Demandes de bypass actuellement actives"})]}),e.jsx(f,{className:"p-3 sm:p-4 pt-0",children:e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground text-center py-6 sm:py-8",children:"Aucun bypass actif."})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"w-full box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs(F,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(as,{className:"w-4 h-4 sm:w-4 sm:h-4"}),"Filtres"]})}),e.jsxs(f,{className:"p-4 sm:p-6 w-full min-w-0",children:[e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 w-full min-w-0",children:[e.jsxs("div",{className:"relative sm:col-span-2 lg:col-span-1 w-full min-w-0",children:[e.jsx(Fe,{className:"absolute left-2 top-2.5 h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground"}),e.jsx(je,{placeholder:"Rechercher...",value:r,onChange:s=>u(s.target.value),className:"pl-8 sm:pl-10 w-full text-sm"})]}),e.jsxs(k,{value:l,onValueChange:d,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Statut"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Tous les statuts"}),e.jsx(a,{value:"draft",children:"Brouillon"}),e.jsx(a,{value:"pending",children:"En attente"}),e.jsx(a,{value:"approved",children:"Approuvé"}),e.jsx(a,{value:"active",children:"Actif"}),e.jsx(a,{value:"closed",children:"Clôturé"}),e.jsx(a,{value:"expired",children:"Expiré"}),e.jsx(a,{value:"rejected",children:"Rejeté"})]})]}),e.jsxs(k,{value:x,onValueChange:n,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Priorité"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les priorités"}),e.jsx(a,{value:"high",children:"Haute"}),e.jsx(a,{value:"medium",children:"Moyenne"}),e.jsx(a,{value:"low",children:"Faible"})]})]}),e.jsxs(k,{value:m,onValueChange:v,children:[e.jsx(D,{className:"text-sm w-full min-w-0",children:e.jsx(L,{placeholder:"Période"})}),e.jsxs(T,{children:[e.jsx(a,{value:"all",children:"Toutes les périodes"}),e.jsx(a,{value:"today",children:"Aujourd'hui"}),e.jsx(a,{value:"week",children:"Cette semaine"}),e.jsx(a,{value:"month",children:"Ce mois"}),e.jsx(a,{value:"custom",children:"Personnalisée"})]})]}),e.jsxs(M,{variant:"outline",onClick:()=>{u(""),d("all"),n("all"),v("all"),y(void 0)},className:"text-sm w-full sm:w-auto min-w-0 truncate",children:[e.jsx("span",{className:"hidden sm:inline truncate",children:"Réinitialiser filtres"}),e.jsx("span",{className:"sm:hidden truncate",children:"Réinitialiser"})]})]}),m==="custom"&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2 max-w-xs",children:[e.jsx(ce,{className:"text-sm",children:"Sélectionner une date"}),e.jsxs(Oe,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:`w-full justify-start text-left font-normal text-sm ${!o&&"text-muted-foreground"}`,children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),o?He(o,"PPP",{locale:Ye}):e.jsx("span",{children:"Sélectionner une date"})]})}),e.jsx(Je,{className:"w-auto p-0",align:"start",children:e.jsx(Ge,{mode:"single",selected:o,onSelect:y,initialFocus:!0})})]})]})})]})]}),ve.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full min-w-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 min-w-0 flex-wrap",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(ce,{htmlFor:"items-per-page",className:"text-xs sm:text-sm whitespace-nowrap flex-shrink-0",children:"Éléments par page:"}),e.jsxs(k,{value:J.toString(),onValueChange:s=>Le(Number(s)),children:[e.jsx(D,{className:"w-16 sm:w-20 flex-shrink-0 h-8 text-xs sm:text-sm",children:e.jsx(L,{})}),e.jsxs(T,{children:[e.jsx(a,{value:"3",children:"3"}),e.jsx(a,{value:"6",children:"6"}),e.jsx(a,{value:"9",children:"9"}),e.jsx(a,{value:"12",children:"12"}),e.jsx(a,{value:"15",children:"15"})]})]})]})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-left",children:["Affichage de ",we+1," à ",Math.min(Se,ve.length)," sur ",ve.length," demande",ve.length>1?"s":""]})]}),Te()?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx(i,{className:"w-6 h-6 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-5 w-32 mb-2"}),e.jsx(i,{className:"h-4 w-24"})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-24"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-28"})]}),e.jsx(i,{className:"h-3 w-full mt-2"}),e.jsx(i,{className:"h-8 w-24 mt-2"})]})]},c))}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:Array.from({length:J}).map((s,c)=>e.jsxs(p,{className:"w-full min-w-0 box-border",children:[e.jsx(I,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(i,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(i,{className:"h-4 w-32 mb-2"}),e.jsx(i,{className:"h-3 w-48"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(i,{className:"h-5 w-16"}),e.jsx(i,{className:"h-5 w-20"})]})]})}),e.jsxs(f,{className:"p-3 sm:p-4 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(i,{className:"h-3 w-20"}),e.jsx(i,{className:"h-3 w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(i,{className:"h-3 w-12"}),e.jsx(i,{className:"h-3 w-36"})]})]}),e.jsx(i,{className:"h-3 w-full mt-3 pt-3"}),e.jsx(i,{className:"h-8 w-28 mt-3"})]})]},c))})]}):O==="active"&&le.length===0?e.jsx(p,{className:"w-full box-border",children:e.jsxs(f,{className:"text-center py-6 sm:py-8",children:[e.jsx(Z,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Aucune demande trouvée."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:hidden gap-3 sm:gap-3 md:gap-4 w-full min-w-0",children:O==="active"&&le.map(s=>{var c,g,b;return e.jsxs(p,{className:"hover:shadow-lg transition-shadow flex flex-col h-full w-full min-w-0 box-border",children:[e.jsxs(I,{className:"pb-4 p-6 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-1.5 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 flex-shrink-0",children:ne(s.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(F,{className:"text-lg truncate min-w-0",children:s.request_code}),e.jsxs(Ne,{className:"text-xs line-clamp-2 mt-1.5 min-w-0",children:[((c=s.equipment)==null?void 0:c.name)||"N/A"," - ",((g=s.sensor)==null?void 0:g.name)||"N/A"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-3 flex-wrap",children:[e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]})]}),e.jsxs(f,{className:"space-y-1.5 p-6 pt-0 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Demandeur:"}),e.jsx("span",{className:"text-xs truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between min-w-0",children:[e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Date:"}),e.jsx("span",{className:"text-xs truncate whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{dateStyle:"short",timeStyle:"short"})})]}),s.description&&e.jsx("div",{className:"pt-1",children:e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 min-w-0",children:s.description})}),e.jsx("div",{className:"pt-2",children:e.jsx(he,{request:s})})]})]},s.id)})}),e.jsx("div",{className:"hidden lg:block space-y-3 sm:space-y-4 md:space-y-6 w-full min-w-0",children:O==="active"&&le.map(s=>{var c,g,b;return e.jsx(p,{className:"hover:shadow-lg transition-shadow w-full min-w-0 box-border",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-shrink-0",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex-shrink-0",children:e.jsx("div",{className:"text-blue-600",children:s.status==="Approuvé"||s.status==="approved"?e.jsx(de,{className:"w-5 h-5 sm:w-6 sm:h-6"}):ne(s.status)?e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center",children:ne(s.status)}):e.jsx(Z,{className:"w-5 h-5 sm:w-6 sm:h-6"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap mb-2",children:[e.jsx(F,{className:"text-base sm:text-lg font-bold truncate min-w-0",children:s.request_code}),e.jsx(P,{variant:"outline",className:oe(s.priority)+" text-xs whitespace-nowrap flex-shrink-0",children:s.priority}),e.jsx(P,{className:xe(s.status)+" text-xs whitespace-nowrap flex-shrink-0",children:s.status})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((c=s.equipment)==null?void 0:c.name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:((g=s.sensor)==null?void 0:g.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 flex-1 min-w-0 items-center sm:items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-center truncate",children:((b=s.requester)==null?void 0:b.full_name)||"N/A"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center whitespace-nowrap",children:new Date(s.created_at).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),s.description&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center line-clamp-2 max-w-[300px]",children:s.description})]}),e.jsx("div",{className:"flex flex-col gap-2 sm:gap-3 flex-shrink-0 w-full sm:w-auto items-center sm:items-center",children:e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(he,{request:s})})})]})})},s.id)})})]}),ve.length>0&&$>1&&e.jsx("div",{className:"flex justify-center sm:justify-end items-center mt-4 sm:mt-6 w-full min-w-0 overflow-x-hidden",children:e.jsx(Re,{children:e.jsxs(Ee,{className:"flex-wrap min-w-0",children:[e.jsx(ee,{children:e.jsx(Ve,{href:"#",onClick:s=>{s.preventDefault(),C>1&&X(C-1)},className:C===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:$},(s,c)=>c+1).map(s=>e.jsx(ee,{children:e.jsx(ze,{href:"#",onClick:c=>{c.preventDefault(),X(s)},isActive:C===s,className:"cursor-pointer",children:s})},s)),e.jsx(ee,{children:e.jsx(Be,{href:"#",onClick:s=>{s.preventDefault(),C<$&&X(C+1)},className:C===$?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})})]})]})]})}export{rt as default};
