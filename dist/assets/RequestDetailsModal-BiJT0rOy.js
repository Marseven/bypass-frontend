import{c as L,r as l,t as W,j as e,D as g,A as G,B as t,E as K,F as f,G as v,H as N,K as y,T as w,h as M,U as V,M as R,e as X,J as _,z as E}from"./index-BeE9M12_.js";import{C as d,b as o,c as m,a as x}from"./card-DyHadcFO.js";import{T as F}from"./textarea-DUx9yspE.js";import{g as A,s as Z,p as $}from"./statusLabels-Cvvyzy4o.js";import{F as C}from"./file-text-Dt1o1hX0.js";import{C as Q}from"./calendar-BlUpukkB.js";import{M as Y}from"./map-pin-DNTjCa9h.js";import{C as T}from"./circle-check-big-CdLTbvOs.js";import{C as k}from"./clock-niJurPOf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=L("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=L("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);function me({request:s}){const[b,i]=l.useState(!1);l.useState({validation_status:"approved",rejection_reason:""});const O=W(),[u,r]=l.useState(!1),[p,h]=l.useState(!1),[n,D]=l.useState(""),z=a=>{switch(a){case"Haute":return"bg-destructive text-destructive-foreground";case"high":return"bg-destructive text-destructive-foreground";case"Moyenne":return"bg-warning text-warning-foreground";case"medium":return"bg-warning text-warning-foreground";case"Faible":return"bg-success text-success-foreground";case"low":return"bg-success text-success-foreground";default:return"bg-muted text-muted-foreground"}},I={preventive_maintenance:"Maintenance préventive",corrective_maintenance:"Maintenance corrective",calibration:"Étalonnage",testing:"Tests",emergency_repair:"Réparation d'urgence",system_upgrade:"Mise à niveau système",investigation:"Investigation",other:"Autre"};function B(a){return I[a]??a}const S=(a,j)=>{try{X({method:"put",url:`/requests/${a}/validate`,data:j}).then(c=>{c?(_.success("Demande de Bypass Soumis avec Succes"),O("/requests/mine")):_.error("Probleme de connexion")}),r(!u),h(!p),i(!b)}catch(c){console.error("Erreur lors de la soumission:",c)}},H=a=>{switch(a){case"En attente":return"bg-warning text-warning-foreground";case"pending":return"bg-warning text-warning-foreground";case"Approuvé":return"bg-success text-success-foreground";case"approved":return"bg-success text-success-foreground";case"En cours":return"bg-primary text-primary-foreground";case"in_progress":return"bg-primary text-primary-foreground";default:return"bg-muted text-muted-foreground"}},P=a=>{switch(a){case"En attente":return e.jsx(k,{className:"w-4 h-4"});case"pending":return e.jsx(k,{className:"w-4 h-4"});case"Approuvé":return e.jsx(T,{className:"w-4 h-4"});case"approved":return e.jsx(T,{className:"w-4 h-4"});case"En cours":return e.jsx(w,{className:"w-4 h-4"});case"in_progress":return e.jsx(w,{className:"w-4 h-4"});case"Rejeté":return e.jsx(E,{className:"w-4 h-4"});case"rejected":return e.jsx(E,{className:"w-4 h-4"});default:return e.jsx(C,{className:"w-4 h-4"})}},J=(a,j)=>{const c=new Date(a),U=new Date(j);return(c.getTime()-U.getTime())/(1e3*60*60)};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{open:b,onOpenChange:i,children:[e.jsx(G,{asChild:!0,children:e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Voir"]})}),e.jsxs(f,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Détails de la demande ",s.request_code]}),e.jsx(y,{children:"Informations complètes de la demande de bypass"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Statut et priorité"]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P(s.status),e.jsx(M,{className:H(s.status),children:A(Z,s.status)})]}),e.jsxs(M,{variant:"outline",className:z(s.priority),children:["Priorité ",A($,s.priority)]})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Informations générales"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(V,{className:"w-4 h-4"}),"Demandeur"]}),e.jsx("p",{className:"font-medium",children:s.requester?s.requester.full_name:"Moi"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"w-4 h-4"}),"Date de demande"]}),e.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(q,{className:"w-4 h-4"}),"Raison du bypass"]}),e.jsx("p",{className:"font-medium",children:B(s.title)})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Équipement et capteur"]})}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Équipement"}),e.jsx("p",{className:"font-medium",children:s.equipment.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Capteur concerné"}),e.jsx("p",{className:"font-medium",children:s.sensor.name})]})]})})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{className:"text-lg",children:"Détails supplémentaires"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Durée estimée"}),e.jsxs("p",{className:"font-medium",children:[J(s.end_time,s.start_time)," heures"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Zone"}),e.jsx("p",{className:"font-medium",children:s.equipment.zone.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Date de début prévue"}),e.jsx("p",{className:"font-medium",children:new Date(s.start_time).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Date de fin prévue"}),e.jsx("p",{className:"font-medium",children:new Date(s.end_time).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsx(R,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Justification détaillée"}),e.jsx("p",{className:"text-sm bg-muted/50 p-3 rounded",children:s.description})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4",children:[e.jsx(t,{variant:"outline",onClick:()=>i(!1),children:"Fermer"}),s.status==="pending"&&(s.requester.role==="administrator"||s.requester.role==="supervisor")&&e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"destructive",onClick:()=>{r(!u)},children:"Rejeter"}),e.jsx(t,{onClick:()=>{h(!p)},children:"Approuver"})]})]})]})]})]}),e.jsx(g,{open:u,onOpenChange:r,children:e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Raison du rejet"}),e.jsx(y,{children:"Merci de saisir une justification avant de rejeter la demande."})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(F,{placeholder:"Expliquez la raison du rejet... Ecrire (RAS) au cas contraire",value:n,onChange:a=>D(a.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(t,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsx(t,{variant:"destructive",onClick:()=>{S(s.id,{validation_status:"rejected",rejection_reason:n}),r(!1),i(!1)},disabled:!n.trim(),children:"Confirmer le rejet"})]})]})}),e.jsx(g,{open:p,onOpenChange:h,children:e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(N,{children:"Raison de la validation"}),e.jsx(y,{children:"Merci de saisir une justification avant d'Accepter la demande."})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(F,{placeholder:"Expliquez la raison du rejet... Ecrire (RAS) au cas contraire",value:n,onChange:a=>D(a.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(t,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsx(t,{variant:"destructive",onClick:()=>{S(s.id,{validation_status:"approved",rejection_reason:n}),r(!1),i(!1)},disabled:!n.trim(),children:"Confirmer la validation"})]})]})})]})}export{oe as F,me as R};
