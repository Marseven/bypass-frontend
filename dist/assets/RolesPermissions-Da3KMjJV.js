import{r as n,e as P,J as p,j as e,aC as O,L as D,B as d,D as U,F,G,H as I,K as _,N as $,f as w,h as f}from"./index-BMrJ7TPv.js";import{C as j,a as b,b as J,c as K,d as Z}from"./card-Czu7AEdR.js";import{L as y}from"./label-Lykqkk46.js";import{T as Q,a as X,b as q,c as m,d as Y,e as l}from"./table-CNS3Mh4q.js";import{C as ee}from"./checkbox-Ut2yWxN2.js";import{B as se,a as te,b as B,c as re,d as ae,e as ie}from"./breadcrumb-DvOId1w-.js";import{A as ne}from"./arrow-left-Cbv8asXn.js";import{S as le}from"./save-B-OkttZU.js";import{P as me}from"./pen-Co3bExJB.js";import"./index-BHZ4bV--.js";const be=()=>{const[v,L]=n.useState([]),[A,o]=n.useState(!1),[a,c]=n.useState(null),[C,z]=n.useState([]),[S,V]=n.useState([]),[u,x]=n.useState(!0),[k,h]=n.useState(null);n.useEffect(()=>{N(),E()},[]);const E=async()=>{var s,r;try{const t=await P.get("/permissions");console.log("Permissions response:",t.data),t.data&&t.data.data?V(t.data.data):console.warn("No permissions data in response:",t.data)}catch(t){console.error("Error fetching permissions:",t),p.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Erreur lors du chargement des permissions")}},N=async()=>{var s,r;x(!0),h(null);try{const t=await P.get("/roles");console.log("Roles response:",t.data),t.data&&t.data.data?L(t.data.data):(console.warn("No roles data in response:",t.data),h("Aucune donnée reçue du serveur"))}catch(t){console.error("Error fetching roles:",t);const i=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||t.message||"Erreur lors du chargement des rôles";h(i),p.error(i)}finally{x(!1)}},T=async()=>{var s,r;if(a){x(!0);try{await P.put(`/roles/${a.id}/permissions`,{permissions:C}),p.success("Permissions mises à jour avec succès"),o(!1),c(null),N()}catch(t){console.error("Error saving permissions:",t),p.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Erreur lors de la sauvegarde des permissions")}finally{x(!1)}}},M=s=>{c(s),z(s.permissions.map(r=>r.name)),o(!0)},H=s=>{z(r=>r.includes(s)?r.filter(t=>t!==s):[...r,s])},g=s=>({"requests.create":"Créer des demandes","requests.view.own":"Voir ses propres demandes","requests.view.all":"Voir toutes les demandes","requests.update.own":"Modifier ses propres demandes","requests.delete.own":"Supprimer ses propres demandes","requests.validate.level1":"Valider niveau 1","requests.validate.level2":"Valider niveau 2","users.view":"Voir les utilisateurs","users.create":"Créer des utilisateurs","users.update":"Modifier des utilisateurs","users.delete":"Supprimer des utilisateurs","equipment.view":"Voir les équipements","equipment.create":"Créer des équipements","equipment.update":"Modifier des équipements","equipment.delete":"Supprimer des équipements","zones.view":"Voir les zones","zones.create":"Créer des zones","zones.update":"Modifier des zones","zones.delete":"Supprimer des zones","sensors.view":"Voir les capteurs","sensors.create":"Créer des capteurs","sensors.update":"Modifier des capteurs","sensors.delete":"Supprimer des capteurs","system.settings.manage":"Gérer les paramètres système","history.view":"Voir l'historique","dashboard.view":"Voir le tableau de bord"})[s]||s,R=s=>({"requests.create":"Permet de créer de nouvelles demandes de bypass","requests.view.own":"Permet de voir uniquement ses propres demandes","requests.view.all":"Permet de voir toutes les demandes du système","requests.validate.level1":"Permet de valider les demandes au niveau 1 (supervisor)","requests.validate.level2":"Permet de valider les demandes au niveau 2 (administrator/director)","users.view":"Permet de consulter la liste des utilisateurs","users.create":"Permet de créer de nouveaux utilisateurs","users.update":"Permet de modifier des utilisateurs existants","users.delete":"Permet de supprimer des utilisateurs","equipment.view":"Permet de consulter la liste des équipements","equipment.create":"Permet de créer de nouveaux équipements","equipment.update":"Permet de modifier des équipements existants","equipment.delete":"Permet de supprimer des équipements","zones.view":"Permet de consulter la liste des zones","zones.create":"Permet de créer de nouvelles zones","zones.update":"Permet de modifier des zones existantes","zones.delete":"Permet de supprimer des zones","sensors.view":"Permet de consulter la liste des capteurs","sensors.create":"Permet de créer de nouveaux capteurs","sensors.update":"Permet de modifier des capteurs existants","sensors.delete":"Permet de supprimer des capteurs","system.settings.manage":"Permet de modifier les paramètres système","history.view":"Permet de consulter l'historique des actions","dashboard.view":"Permet d'accéder au tableau de bord"})[s]||"",W=s=>{const r={Demandes:[],Utilisateurs:[],Équipements:[],Zones:[],Capteurs:[],Système:[]};return s.forEach(t=>{t.name.startsWith("requests.")?r.Demandes.push(t):t.name.startsWith("users.")?r.Utilisateurs.push(t):t.name.startsWith("equipment.")?r.Équipements.push(t):t.name.startsWith("zones.")?r.Zones.push(t):t.name.startsWith("sensors.")?r.Capteurs.push(t):r.Système.push(t)}),r};return e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx(j,{className:"bg-card rounded-lg border",children:e.jsx(b,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words mb-1",children:"Gestion des Rôles et Permissions"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words mb-2",children:"Configurez les permissions pour chaque rôle"}),e.jsx(se,{children:e.jsxs(te,{children:[e.jsx(B,{children:e.jsx(re,{asChild:!0,children:e.jsx(D,{to:"/",children:"Tableau de bord"})})}),e.jsx(ae,{}),e.jsx(B,{children:e.jsx(ie,{children:"Rôles et Permissions"})})]})})]})]}),e.jsx(d,{variant:"outline",size:"icon",className:"flex-shrink-0 rounded-full w-10 h-10",asChild:!0,children:e.jsx(D,{to:"/",children:e.jsx(ne,{className:"w-4 h-4"})})})]})})}),e.jsx(U,{open:A,onOpenChange:s=>{o(s),s||c(null)},children:e.jsxs(F,{className:"max-w-lg w-[95vw] sm:w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsxs(I,{className:"text-base sm:text-lg",children:["Modifier les permissions - ",a==null?void 0:a.name]}),e.jsxs(_,{className:"text-sm",children:['Ajoutez ou retirez des permissions pour le rôle "',a==null?void 0:a.name,'"']})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4 w-full min-w-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{className:"text-xs sm:text-sm text-muted-foreground",children:["Rôle: ",e.jsx("span",{className:"font-medium",children:a==null?void 0:a.name})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Nombre d'utilisateurs: ",(a==null?void 0:a.user_count)||0]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx(y,{className:"text-sm sm:text-base font-semibold",children:"Permissions"}),S.length>0&&(()=>{const s=W(S);return Object.entries(s).map(([r,t])=>t.length>0?e.jsxs("div",{className:"space-y-2 sm:space-y-3 border rounded-lg p-3 sm:p-4",children:[e.jsx("h4",{className:"text-xs sm:text-sm font-semibold mb-2 sm:mb-3",children:r}),t.map(i=>e.jsxs("div",{className:"flex items-start space-x-2 sm:space-x-3 min-w-0",children:[e.jsx(ee,{id:`perm-${i.id}`,checked:C.includes(i.name),onCheckedChange:()=>H(i.name),className:"mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(y,{htmlFor:`perm-${i.id}`,className:"text-xs sm:text-sm font-medium cursor-pointer break-words",children:g(i.name)}),e.jsx("p",{className:"text-xs text-muted-foreground break-words",children:R(i.name)})]})]},i.id))]},r):null)})()]})]}),e.jsxs($,{className:"flex-col sm:flex-row gap-2 sm:gap-0",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>{o(!1),c(null)},disabled:u,className:"w-full sm:w-auto text-sm",children:"Annuler"}),e.jsxs(d,{onClick:T,disabled:u,className:"w-full sm:w-auto text-sm",children:[e.jsx(le,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-2"}),u?"Enregistrement...":"Enregistrer les permissions"]})]})]})}),u?e.jsx(j,{className:"w-full min-w-0 box-border",children:e.jsx(b,{className:"p-6 sm:p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(w,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mb-4 animate-pulse"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Chargement des rôles..."}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Veuillez patienter pendant le chargement des données."})]})})}):k?e.jsx(j,{className:"w-full min-w-0 box-border",children:e.jsxs(b,{className:"p-6 sm:p-12 text-center",children:[e.jsx(w,{className:"w-10 h-10 sm:w-12 sm:h-12 text-destructive mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-4",children:k}),e.jsx(d,{onClick:()=>{h(null),N(),E()},children:"Réessayer"})]})}):e.jsxs(j,{className:"w-full min-w-0 box-border",children:[e.jsxs(J,{className:"p-3 sm:p-4",children:[e.jsxs(K,{className:"flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(w,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Rôles (",v.length,")"]}),e.jsx(Z,{className:"text-xs sm:text-sm",children:"Liste des rôles et leurs permissions"})]}),e.jsx(b,{className:"p-0 sm:p-3 w-full min-w-0 overflow-hidden box-border",children:e.jsx("div",{className:"w-full min-w-0 overflow-x-hidden box-border",children:e.jsxs(Q,{className:"w-full",children:[e.jsx(X,{children:e.jsxs(q,{children:[e.jsx(m,{className:"text-xs sm:text-sm min-w-0 w-[20%] sm:w-auto",children:"Nom"}),e.jsx(m,{className:"text-xs sm:text-sm hidden sm:table-cell min-w-0 w-[15%]",children:"Code"}),e.jsx(m,{className:"text-xs sm:text-sm hidden md:table-cell min-w-0 w-[25%]",children:"Description"}),e.jsx(m,{className:"text-xs sm:text-sm hidden lg:table-cell min-w-0 w-[10%]",children:"Utilisateurs"}),e.jsx(m,{className:"text-xs sm:text-sm min-w-0 w-[20%] sm:w-auto",children:"Permissions"}),e.jsx(m,{className:"text-xs sm:text-sm text-right min-w-0 w-[15%] sm:w-auto",children:"Actions"})]})}),e.jsx(Y,{children:v.length===0?e.jsx(q,{children:e.jsxs(l,{colSpan:6,className:"text-center py-6 sm:py-8",children:[e.jsx(w,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Aucun rôle"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Les rôles sont prédéfinis dans le système."})]})}):v.map(s=>e.jsxs(q,{children:[e.jsx(l,{className:"font-medium text-xs sm:text-sm min-w-0 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col sm:block min-w-0",children:[e.jsx("span",{className:"truncate sm:whitespace-normal",children:s.name}),e.jsx("span",{className:"text-xs text-muted-foreground sm:hidden mt-1 truncate",children:s.guard_name})]})}),e.jsx(l,{className:"hidden sm:table-cell min-w-0 overflow-hidden",children:e.jsx(f,{variant:"outline",className:"text-xs whitespace-nowrap",children:s.name})}),e.jsx(l,{className:"text-xs sm:text-sm hidden md:table-cell truncate min-w-0 overflow-hidden max-w-[200px]",children:s.name==="user"?"Utilisateur standard pouvant soumettre des demandes":s.name==="supervisor"?"Superviseur pouvant approuver les demandes de niveau 1":s.name==="director"?"Directeur pouvant approuver les demandes de niveau 2":s.name==="administrator"?"Administrateur avec tous les droits":""}),e.jsx(l,{className:"hidden lg:table-cell min-w-0 overflow-hidden",children:e.jsx(f,{variant:"secondary",className:"text-xs sm:text-sm whitespace-nowrap",children:s.user_count||0})}),e.jsx(l,{className:"min-w-0 overflow-hidden",children:e.jsxs("div",{className:"flex flex-wrap gap-0.5 sm:gap-1",children:[s.permissions&&s.permissions.slice(0,2).map(r=>e.jsxs(f,{variant:"outline",className:"text-xs truncate max-w-[80px] sm:max-w-none",children:[e.jsx("span",{className:"hidden sm:inline",children:g(r.name)}),e.jsx("span",{className:"sm:hidden",children:g(r.name).split(" ")[0]})]},r.id)),s.permissions&&s.permissions.length>2&&e.jsxs(f,{variant:"outline",className:"text-xs whitespace-nowrap",children:["+",s.permissions.length-2]})]})}),e.jsx(l,{className:"text-right min-w-0 overflow-hidden",children:e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>M(s),className:"text-xs sm:text-sm h-7 sm:h-8 p-1 sm:p-2",children:[e.jsx(me,{className:"h-3 w-3 sm:h-4 sm:w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Modifier les permissions"})]})})]},s.id))})]})})})]})]})};export{be as default};
