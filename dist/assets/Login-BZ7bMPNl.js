import{c as P,a6 as R,s as T,r as f,t as V,j as e,a7 as g,q as j,B as v,E as A,v as D,e as b}from"./index-DfPQvTeb.js";import{u as G,g as U,h as H,F as y,a as N,b as w,c as C,d as L,o as O,s as E}from"./form-Dxhe_hWm.js";import{C as $,b as J,c as K,d as Q,a as W}from"./card-Dy4NsJr3.js";import{E as X}from"./eye-off-BnXvSBQN.js";import"./label-KSYSo44B.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=P("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Z=O({username:E("Username invalide"),password:E().min(1,"Le mot de passe est requis")});function oe(){const{toast:n}=R(),l=T(),[a,i]=f.useState(!1),[c,F]=f.useState(!1),{user:S,token:k,login:I}=V(),o=G({resolver:U(Z),defaultValues:{username:"",password:""}});if(k)return S.role==="user"?e.jsx(g,{to:"/requests/new",replace:!0}):e.jsx(g,{to:"/",replace:!0});const M=async r=>{var d,m;i(!0);try{const s=await b({method:"post",url:"/auth/login",data:r});if(console.log("Success:",s.data.data),s.data.data.length!==0){I(s.data.data.user,s.data.data.token),n({title:"Connexion réussie",description:"Vous êtes maintenant connecté."});try{const z=((await b.get("/notifications")).data||[]).filter(t=>!t.read_at),_=t=>({preventive_maintenance:"Maintenance préventive",corrective_maintenance:"Maintenance corrective",calibration:"Étalonnage",testing:"Tests",emergency_repair:"Réparation d'urgence",system_upgrade:"Mise à niveau système",investigation:"Investigation",other:"Autre"})[t]||t;z.forEach((t,x)=>{setTimeout(()=>{var p,h;const q=(p=t.data)!=null&&p.title?_(t.data.title):"Nouvelle notification",B=((h=t.data)==null?void 0:h.description)||"Vous avez une nouvelle notification";n({title:q,description:B,duration:5e3})},x*600)})}catch(u){console.error("Error fetching notifications:",u)}s.data.data.user.role==="user"?l("/requests/new",{replace:!0}):l("/",{replace:!0})}else console.log("Login failed: ",s.data),n({title:"Échec de la connexion",description:"Email ou mot de passe incorrect.",variant:"destructive"}),i(!1)}catch(s){console.error("Error:",s),n({title:"Erreur",description:((m=(d=s.response)==null?void 0:d.data)==null?void 0:m.message)||"Une erreur est survenue lors de la connexion.",variant:"destructive"}),i(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-secondary/5 p-6 relative",children:[a&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center w-32 h-32",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-primary/10 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary border-r-primary rounded-full animate-spin",style:{animationDuration:"1s"}}),e.jsx("div",{className:"relative z-10 w-20 h-20 flex items-center justify-center bg-white rounded-xl p-3 shadow-lg",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard",className:"w-full h-full object-contain"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-foreground",children:"Connexion en cours..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Veuillez patienter"})]})]})}),e.jsxs($,{className:`w-full max-w-md shadow-xl border-primary/10 ${a?"opacity-50 pointer-events-none":""}`,children:[e.jsxs(J,{className:"space-y-1 text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-18 mx-auto mb-4",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard"})}),e.jsx(K,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Connexion"}),e.jsx(Q,{children:"Connectez-vous à votre compte pour accéder au système"})]}),e.jsx(W,{children:e.jsx(H,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(M),className:"space-y-4",children:[e.jsx(y,{control:o.control,name:"username",render:({field:r})=>e.jsxs(N,{children:[e.jsx(w,{children:"Email"}),e.jsx(C,{children:e.jsx(j,{type:"text",placeholder:"administrateur",disabled:a,...r})}),e.jsx(L,{})]})}),e.jsx(y,{control:o.control,name:"password",render:({field:r})=>e.jsxs(N,{children:[e.jsx(w,{children:"Mot de passe"}),e.jsx(C,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:c?"text":"password",placeholder:"••••••••",disabled:a,...r}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>F(!c),disabled:a,children:c?e.jsx(X,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]})}),e.jsx(L,{})]})}),e.jsx(v,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Connexion en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Se connecter"]})})]})})})]})]})}export{oe as default};
