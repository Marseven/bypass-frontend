import{a9 as I,r as l,j as e,B as d,aB as y,h as _,D as O,F as q,G as B,H as F,K as M,e as C}from"./index-BMrJ7TPv.js";import{C as x,b as A,c as R,d as H}from"./card-Czu7AEdR.js";const K=()=>{const{toast:p}=I(),[o,u]=l.useState([]),[D,g]=l.useState(!0),[i,f]=l.useState("all"),[a,N]=l.useState(null),[S,h]=l.useState(!1),[j,b]=l.useState(10),k={preventive_maintenance:"Maintenance préventive",corrective_maintenance:"Maintenance corrective",calibration:"Étalonnage",testing:"Tests",emergency_repair:"Réparation d'urgence",system_upgrade:"Mise à niveau système",investigation:"Investigation",other:"Autre"},v=t=>k[t]??t,L=async()=>{g(!0);try{const t=await C.get("/notifications");u(t.data||[])}catch(t){console.error("Error fetching notifications:",t)}finally{g(!1)}};l.useEffect(()=>{L()},[]);const c=o.filter(t=>!t.read_at).length,$=o.filter(t=>t.read_at).length,m=[...o].sort((t,s)=>new Date(s.created_at).getTime()-new Date(t.created_at).getTime()).filter(t=>i==="unread"?!t.read_at:i==="read"?t.read_at:!0),T=m.slice(0,j),E=m.length>j;l.useEffect(()=>{b(10)},[i]);const z=async t=>{if(N(t),h(!0),!t.read_at)try{const s=await C.get(`/notifications/${t.id}/mark-as-read`);s.data&&s.data.notification?u(r=>r.map(n=>n.id===t.id?s.data.notification:n)):u(r=>r.map(n=>n.id===t.id?{...n,read_at:new Date().toISOString()}:n)),N(r=>{var n,w;return r&&r.id===t.id?{...r,read_at:((w=(n=s.data)==null?void 0:n.notification)==null?void 0:w.read_at)||new Date().toISOString()}:r}),p({title:"Notification marquée comme lue",description:"La notification a été marquée comme lue."})}catch(s){console.error("Error marking notification as read:",s),p({title:"Erreur",description:"Impossible de marquer la notification comme lue.",variant:"destructive"})}};return e.jsxs("div",{className:"w-full p-3 sm:p-4 md:p-6 space-y-4 sm:space-y-6 overflow-x-hidden box-border",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 p-3 sm:p-4 min-w-0 box-border",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground break-words",children:"Notifications"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground break-words",children:c>0?`${c} notification${c>1?"s":""} non lue${c>1?"s":""}`:"Toutes vos notifications"})]})}),o.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(d,{variant:i==="all"?"default":"outline",size:"sm",onClick:()=>f("all"),className:"text-xs sm:text-sm",children:["Toutes (",o.length,")"]}),e.jsxs(d,{variant:i==="unread"?"default":"outline",size:"sm",onClick:()=>f("unread"),className:"text-xs sm:text-sm",children:["Non lues (",c,")"]}),e.jsxs(d,{variant:i==="read"?"default":"outline",size:"sm",onClick:()=>f("read"),className:"text-xs sm:text-sm",children:["Lues (",$,")"]})]}),D?e.jsx(x,{className:"p-6 sm:p-12 text-center",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/4 mx-auto"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"})]})}):o.length===0?e.jsxs(x,{className:"p-6 sm:p-12 text-center",children:[e.jsx(y,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:"Aucune notification"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Vous n'avez aucune notification pour l'instant."})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[T.map(t=>{const s=!t.read_at;return e.jsx(x,{onClick:()=>z(t),className:`transition-colors cursor-pointer ${s?"border-primary/50 bg-primary/5 hover:bg-primary/10 shadow-sm":"bg-card/50 hover:bg-card opacity-75"}`,children:e.jsx(A,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${s?"bg-primary":"bg-transparent"}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(R,{className:`text-sm sm:text-base mb-1 ${s?"font-semibold text-foreground":"text-black font-normal"}`,children:v(t.data.title)}),e.jsx(H,{className:`text-xs sm:text-sm mt-1 ${s?"text-foreground/80":"text-black"}`,children:t.data.description}),e.jsx("p",{className:"text-xs text-black mt-2",children:new Date(t.created_at).toLocaleString("fr-FR",{dateStyle:"medium",timeStyle:"short"})})]})]}),e.jsx(_,{variant:s?"default":"outline",className:`text-xs flex-shrink-0 ${s?"bg-primary":"text-black border-black/30"}`,children:s?"Non lue":"Lue"})]})})},t.id)}),m.length===0&&e.jsxs(x,{className:"p-6 sm:p-12 text-center",children:[e.jsx(y,{className:"w-10 h-10 sm:w-12 sm:h-12 text-muted-foreground mx-auto mb-4"}),e.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2",children:["Aucune notification ",i==="unread"?"non lue":i==="read"?"lue":""]}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:i==="unread"?"Vous n'avez aucune notification non lue.":i==="read"?"Vous n'avez aucune notification lue.":"Aucune notification trouvée."})]}),E&&m.length>0&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(d,{variant:"outline",onClick:()=>b(t=>t+10),className:"w-full sm:w-auto",children:"Lire plus"})})]}),e.jsx(O,{open:S,onOpenChange:h,children:e.jsxs(q,{className:"max-w-4xl w-[95vw] sm:w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsx(F,{className:"text-lg sm:text-xl",children:a&&v(a.data.title)}),e.jsx(M,{className:"text-xs sm:text-sm text-muted-foreground",children:a&&new Date(a.created_at).toLocaleString("fr-FR",{dateStyle:"full",timeStyle:"short"})})]}),a&&e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:a.data.description})]}),a.data.details&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Détails"}),e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:typeof a.data.details=="string"?a.data.details:JSON.stringify(a.data.details,null,2)})]}),a.data.request_code&&e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Code de demande"}),e.jsx("p",{className:"text-sm text-foreground font-mono",children:a.data.request_code})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx(_,{variant:a.read_at?"outline":"default",children:a.read_at?"Lue":"Non lue"}),e.jsx(d,{variant:"outline",onClick:()=>h(!1),children:"Fermer"})]})]})]})})]})};export{K as default};
