import{c as P,a6 as R,s as T,r as f,t as V,j as e,a7 as g,q as j,B as v,E as A,v as D,e as b}from"./index-DV8VrR_L.js";import{u as G,g as O,h as H,F as y,a as N,b as w,c as L,d as C,o as U,s as E}from"./form-Bbjhktqh.js";import{C as $,b as J,c as K,d as Q,a as W}from"./card-B22LoB-E.js";import{E as X}from"./eye-off-CZv-nR3M.js";import"./label-DnK22MNH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=P("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),Z=U({username:E({required_error:"L'identifiant est requis"}).min(1,"L'identifiant est requis"),password:E().min(1,"Le mot de passe est requis")});function ie(){const{toast:n}=R(),c=T(),[a,o]=f.useState(!1),[l,S]=f.useState(!1),{user:F,token:k,login:M}=V(),i=G({resolver:O(Z),defaultValues:{username:"",password:""}});if(k)return F.role==="user"?e.jsx(g,{to:"/requests/new",replace:!0}):e.jsx(g,{to:"/",replace:!0});const q=async r=>{var d,u;o(!0);try{const s=await b({method:"post",url:"/auth/login",data:r});if(console.log("Success:",s.data.data),s.data.data.length!==0){M(s.data.data.user,s.data.data.token),n({title:"Connexion reussie",description:"Vous etes maintenant connecte."});try{const I=((await b.get("/notifications")).data||[]).filter(t=>!t.read_at),z=t=>({preventive_maintenance:"Maintenance preventive",corrective_maintenance:"Maintenance corrective",calibration:"Etalonnage",testing:"Tests",emergency_repair:"Reparation d'urgence",system_upgrade:"Mise a niveau systeme",investigation:"Investigation",other:"Autre"})[t]||t;I.forEach((t,x)=>{setTimeout(()=>{var p,h;const _=(p=t.data)!=null&&p.title?z(t.data.title):"Nouvelle notification",B=((h=t.data)==null?void 0:h.description)||"Vous avez une nouvelle notification";n({title:_,description:B,duration:5e3})},x*600)})}catch(m){console.error("Error fetching notifications:",m)}s.data.data.user.role==="user"?c("/requests/new",{replace:!0}):c("/",{replace:!0})}else console.log("Login failed: ",s.data),n({title:"Echec de la connexion",description:"Email ou mot de passe incorrect.",variant:"destructive"}),o(!1)}catch(s){console.error("Error:",s),n({title:"Erreur",description:((u=(d=s.response)==null?void 0:d.data)==null?void 0:u.message)||"Une erreur est survenue lors de la connexion.",variant:"destructive"}),o(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background bg-grid-pattern p-6 relative",children:[e.jsx("div",{className:"absolute top-1/3 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[400px] bg-primary/5 rounded-full blur-[120px] pointer-events-none"}),a&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-6",children:[e.jsxs("div",{className:"relative flex items-center justify-center w-32 h-32",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-primary/10 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-primary border-r-primary rounded-full animate-spin",style:{animationDuration:"1s"}}),e.jsx("div",{className:"relative z-10 w-20 h-20 flex items-center justify-center bg-card rounded-xl p-3 shadow-lg",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard",className:"w-full h-full object-contain"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium text-foreground",children:"Connexion en cours..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Veuillez patienter"})]})]})}),e.jsxs($,{variant:"glass",className:`w-full max-w-md border-border/30 relative ${a?"opacity-50 pointer-events-none":""}`,children:[e.jsxs(J,{className:"space-y-1 text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-16 h-18 mx-auto mb-4",children:e.jsx("img",{src:"/logo.png",alt:"Logo ByPass Guard"})}),e.jsx(K,{className:"text-2xl font-display font-bold text-gradient-primary",children:"MineSafe OS"}),e.jsx(Q,{children:"Connectez-vous pour acceder au systeme de gestion des bypass"})]}),e.jsx(W,{children:e.jsx(H,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(q),className:"space-y-4",children:[e.jsx(y,{control:i.control,name:"username",render:({field:r})=>e.jsxs(N,{children:[e.jsx(w,{children:"Email"}),e.jsx(L,{children:e.jsx(j,{type:"text",placeholder:"administrateur",disabled:a,...r})}),e.jsx(C,{})]})}),e.jsx(y,{control:i.control,name:"password",render:({field:r})=>e.jsxs(N,{children:[e.jsx(w,{children:"Mot de passe"}),e.jsx(L,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:l?"text":"password",placeholder:"••••••••",disabled:a,...r}),e.jsx(v,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>S(!l),disabled:a,children:l?e.jsx(X,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]})}),e.jsx(C,{})]})}),e.jsx(v,{type:"submit",className:"w-full font-display tracking-wide",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Connexion en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Se connecter"]})})]})})})]})]})}export{ie as default};
